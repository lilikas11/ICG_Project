import{C as sn,V as at,b as rt,c as _t,d as Lc,e as di,E as hi,f as pi,L as Zs,g as Cc,h as Ic,I as Oc,i as bc,D as Fo,j as zc,k as Dc,l as Fc,F as Hc,m as mi,n as on,N as An,o as Pc,p as kc,q as fi,r as Gc,s as Bc,t as Uc,u as Wc,v as qc,R as Ft,T as Ln,O as $c,w as Ho,x as Xc,y as jc,z as Yc,A as Zc,G as Jc,H as Kc,J as Qc,a as el,K as tl,Q as Cn,U as sl,X as ol,Y as gi,Z as nl,_ as il,$ as Ni,a0 as rl,a1 as yi,a2 as al,M as cl,a3 as ll,a4 as ul,a5 as dl,a6 as hl,a7 as pl}from"./three.module-DNuG-gUZ.js";import{F as ml}from"./firstperson-BaV68NFy.js";const In={VERTEX:"vertex",FRAGMENT:"fragment"},ae={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Js=["x","y","z","w"];function Ti(o,e=!1){let t="{";o.isNode===!0&&(t+=o.id);for(const{property:s,childNode:n}of Hs(o))t+=","+s.slice(0,-4)+":"+n.getCacheKey(e);return t+="}",t}function*Hs(o,e=!1){for(const t in o){if(t.startsWith("_")===!0)continue;const s=o[t];if(Array.isArray(s)===!0)for(let n=0;n<s.length;n++){const i=s[n];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:n,childNode:i})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const n in s){const i=s[n];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:n,childNode:i})}}}function St(o){if(o==null)return null;const e=typeof o;return o.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":o.isVector2===!0?"vec2":o.isVector3===!0?"vec3":o.isVector4===!0?"vec4":o.isMatrix3===!0?"mat3":o.isMatrix4===!0?"mat4":o.isColor===!0?"color":o instanceof ArrayBuffer?"ArrayBuffer":null}function xi(o,...e){const t=o?o.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),o==="color"?new sn(...e):t==="vec2"?new at(...e):t==="vec3"?new rt(...e):t==="vec4"?new _t(...e):t==="mat3"?new Lc(...e):t==="mat4"?new di(...e):o==="bool"?e[0]||!1:o==="float"||o==="int"||o==="uint"?e[0]||0:o==="string"?e[0]||"":o==="ArrayBuffer"?Ei(e[0]):null}function vi(o){let e="";const t=new Uint8Array(o);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function Ei(o){return Uint8Array.from(atob(o),e=>e.charCodeAt(0)).buffer}const On=new Map;let fl=0;class z extends hi{constructor(e=null){super(),this.nodeType=e,this.updateType=ae.NONE,this.updateBeforeType=ae.NONE,this.uuid=pi.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.isNode=!0,Object.defineProperty(this,"id",{value:fl++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,ae.FRAME)}onRenderUpdate(e){return this.onUpdate(e,ae.RENDER)}onObjectUpdate(e){return this.onUpdate(e,ae.OBJECT)}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:e}of Hs(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=Ti(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);for(const s of this.getChildren())t["_node"+s.id]=s;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}increaseUsage(e){const t=e.getDataFromNode(this);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}analyze(e){if(this.increaseUsage(e)===1){const s=e.getNodeProperties(this);for(const n of Object.values(s))n&&n.isNode===!0&&n.build(e)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let n=null;const i=e.getBuildStage();if(i==="setup"){this.updateReference(e);const r=e.getNodeProperties(this);if(r.initialized!==!0||e.context.tempRead===!1){const a=e.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(e),r.outputNode!==null&&e.stack.nodes.length!==a&&(r.outputNode=e.stack);for(const c of Object.values(r))c&&c.isNode===!0&&c.build(e)}}else if(i==="analyze")this.analyze(e);else if(i==="generate")if(this.generate.length===1){const a=this.getNodeType(e),c=e.getDataFromNode(this);n=c.snippet,n===void 0&&(n=this.generate(e)||"",c.snippet=n),n=e.format(n,a,t)}else n=this.generate(e,t)||"";return e.removeChain(this),n}getSerializeChildren(){return Hs(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:n,index:i,childNode:r}of t)i!==void 0?(s[n]===void 0&&(s[n]=Number.isInteger(i)?[]:{}),s[n][i]=r.toJSON(e.meta).uuid):s[n]=r.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const n=[];for(const i of e.inputNodes[s])n.push(t[i]);this[s]=n}else if(typeof e.inputNodes[s]=="object"){const n={};for(const i in e.inputNodes[s]){const r=e.inputNodes[s][i];n[i]=t[r]}this[s]=n}else{const n=e.inputNodes[s];this[s]=t[n]}}}toJSON(e){const{uuid:t,type:s}=this,n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function r(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}if(n){const a=r(e.textures),c=r(e.images),l=r(e.nodes);a.length>0&&(i.textures=a),c.length>0&&(i.images=c),l.length>0&&(i.nodes=l)}return i}}function x(o,e){if(typeof e!="function"||!o)throw new Error(`Node class ${o} is not a class`);if(On.has(o)){console.warn(`Redefinition of node class ${o}`);return}On.set(o,e),e.type=o}class ce extends z{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(e.context.tempRead!==!1&&i.propertyName!==void 0)return e.format(i.propertyName,n,t);if(e.context.tempWrite!==!1&&n!=="void"&&t!=="void"&&this.hasDependencies(e)){const r=super.build(e,n),a=e.getVarFromNode(this,null,n),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${r}`),i.snippet=r,i.propertyName=c,e.format(i.propertyName,n,t)}}return super.build(e,t)}}x("TempNode",ce);class rs extends z{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}x("ArrayElementNode",rs);class nn extends z{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const n of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(n))&&(s=n);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,n=this.getNodeType(e),i=s.build(e,n);return e.format(i,n,t)}}x("ConvertNode",nn);class wi extends ce{constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),n=this.nodes,i=e.getComponentType(s),r=[];for(const c of n){let l=c.build(e);const u=e.getComponentType(c.getNodeType(e));u!==i&&(l=e.format(l,u,i)),r.push(l)}const a=`${e.getType(s)}( ${r.join(", ")} )`;return e.format(a,s,t)}}x("JoinNode",wi);const gl=Js.join("");class Po extends z{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Js.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const s=this.node,n=e.getTypeLength(s.getNodeType(e));let i=null;if(n>1){let r=null;this.getVectorLength()>=n&&(r=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=s.build(e,r);this.components.length===n&&this.components===gl.slice(0,this.components.length)?i=e.format(c,r,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}x("SplitNode",Po);class Mi extends ce{constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:n}=this,i=this.getNodeType(e),r=e.getTypeFromLength(s.length),a=n.build(e,r),c=t.build(e,i),l=e.getTypeLength(i),u=[];for(let p=0;p<l;p++){const g=Js[p];g===s[0]?(u.push(a),p+=s.length-1):u.push(c+"."+g)}return`${e.getType(i)}( ${u.join(", ")} )`}}x("SetNode",Mi);class Ks extends z{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?St(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=St(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=vi(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?xi(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}x("InputNode",Ks);class st extends Ks{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}x("ConstNode",st);let ns=null;const Yt=new Map;function f(o,e){if(Yt.has(o)){console.warn(`Redefinition of node element ${o}`);return}if(typeof e!="function")throw new Error(`Node element ${o} is not a function`);Yt.set(o,e)}const bn=o=>o.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Ri={setup(o,e){const t=e.shift();return o(to(t),...e)},get(o,e,t){if(typeof e=="string"&&o[e]===void 0){if(o.isStackNode!==!0&&e==="assign")return(...s)=>(ns.assign(t,...s),t);if(Yt.has(e)){const s=Yt.get(e);return o.isStackNode?(...n)=>t.add(s(...n)):(...n)=>s(t,...n)}else{if(e==="self")return o;if(e.endsWith("Assign")&&Yt.has(e.slice(0,e.length-6))){const s=Yt.get(e.slice(0,e.length-6));return o.isStackNode?(...n)=>t.assign(n[0],s(...n)):(...n)=>t.assign(s(t,...n))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=bn(e),V(new Po(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=bn(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),s=>V(new Mi(o,e,s));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),V(new Po(o,e));if(/^\d+$/.test(e)===!0)return V(new rs(t,new st(Number(e),"uint")))}}}return Reflect.get(o,e,t)},set(o,e,t,s){return typeof e=="string"&&o[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(o,e,t,s)}},To=new WeakMap,zn=new WeakMap,Nl=function(o,e=null){const t=St(o);if(t==="node"){let s=To.get(o);return s===void 0&&(s=new Proxy(o,Ri),To.set(o,s),To.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return V(ko(o,e));if(t==="shader")return T(o)}return o},yl=function(o,e=null){for(const t in o)o[t]=V(o[t],e);return o},Tl=function(o,e=null){const t=o.length;for(let s=0;s<t;s++)o[s]=V(o[s],e);return o},xl=function(o,e=null,t=null,s=null){const n=i=>V(s!==null?Object.assign(i,s):i);return e===null?(...i)=>n(new o(...Qt(i))):t!==null?(t=V(t),(...i)=>n(new o(e,...Qt(i),t))):(...i)=>n(new o(e,...Qt(i)))},vl=function(o,...e){return V(new o(...Qt(e)))};class El extends z{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:s}=this;if(t.layout){let r=zn.get(e.constructor);r===void 0&&(r=new WeakMap,zn.set(e.constructor,r));let a=r.get(t);return a===void 0&&(a=V(e.buildFunctionNode(t)),r.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),V(a.call(s))}const n=t.jsFunc,i=s!==null?n(s,e.stack,e):n(e.stack,e);return V(i)}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);return s===null?this.call(e).build(e,t):super.generate(e,t)}}class wl extends z{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return to(e),V(new El(this,e))}setup(){return this.call()}}const Ml=[!1,!0],Rl=[0,1,2,3],Sl=[-1,-2],Si=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],rn=new Map;for(const o of Ml)rn.set(o,new st(o));const an=new Map;for(const o of Rl)an.set(o,new st(o,"uint"));const cn=new Map([...an].map(o=>new st(o.value,"int")));for(const o of Sl)cn.set(o,new st(o,"int"));const Qs=new Map([...cn].map(o=>new st(o.value)));for(const o of Si)Qs.set(o,new st(o));for(const o of Si)Qs.set(-o,new st(-o));const eo={bool:rn,uint:an,ints:cn,float:Qs},Dn=new Map([...rn,...Qs]),ko=(o,e)=>Dn.has(o)?Dn.get(o):o.isNode===!0?o:new st(o,e),_l=o=>{try{return o.getNodeType()}catch{return}},oe=function(o,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(o)&&t.every(n=>typeof n!="object"))&&(t=[xi(o,...t)]),t.length===1&&e!==null&&e.has(t[0]))return V(e.get(t[0]));if(t.length===1){const n=ko(t[0],o);return _l(n)===o?V(n):V(new nn(n,o))}const s=t.map(n=>ko(n));return V(new wi(s,o))}},Vl=o=>o!=null?o.nodeType||o.convertTo||(typeof o=="string"?o:null):null;function gs(o){return new Proxy(new wl(o),Ri)}const V=(o,e=null)=>Nl(o,e),to=(o,e=null)=>new yl(o,e),Qt=(o,e=null)=>new Tl(o,e),y=(...o)=>new xl(...o),w=(...o)=>new vl(...o),T=o=>{const e=new gs(o),t=(...s)=>{let n;return to(s),s[0]&&s[0].isNode?n=[...s]:n=s[0],e.call(n)};return t.shaderNode=e,t.setLayout=s=>(e.setLayout(s),t),t};x("ShaderNode",gs);const Fn=o=>{ns=o},Al=()=>ns,Z=(...o)=>ns.if(...o);function Ll(o){return ns&&ns.add(o),o}f("append",Ll);const Cl=new oe("color"),d=new oe("float",eo.float),h=new oe("int",eo.ints),_=new oe("uint",eo.uint),Ht=new oe("bool",eo.bool),H=new oe("vec2"),Dt=new oe("ivec2"),Il=new oe("uvec2"),Ol=new oe("bvec2"),N=new oe("vec3"),bl=new oe("ivec3"),Rs=new oe("uvec3"),_i=new oe("bvec3"),I=new oe("vec4"),zl=new oe("ivec4"),Dl=new oe("uvec4"),Fl=new oe("bvec4"),Vi=new oe("mat2"),Hl=new oe("imat2"),Pl=new oe("umat2"),kl=new oe("bmat2"),ut=new oe("mat3"),Gl=new oe("imat3"),Bl=new oe("umat3"),Ul=new oe("bmat3"),es=new oe("mat4"),Wl=new oe("imat4"),ql=new oe("umat4"),$l=new oe("bmat4"),Xl=(o="")=>V(new st(o,"string")),jl=o=>V(new st(o,"ArrayBuffer"));f("color",Cl);f("float",d);f("int",h);f("uint",_);f("bool",Ht);f("vec2",H);f("ivec2",Dt);f("uvec2",Il);f("bvec2",Ol);f("vec3",N);f("ivec3",bl);f("uvec3",Rs);f("bvec3",_i);f("vec4",I);f("ivec4",zl);f("uvec4",Dl);f("bvec4",Fl);f("mat2",Vi);f("imat2",Hl);f("umat2",Pl);f("bmat2",kl);f("mat3",ut);f("imat3",Gl);f("umat3",Bl);f("bmat3",Ul);f("mat4",es);f("imat4",Wl);f("umat4",ql);f("bmat4",$l);f("string",Xl);f("arrayBuffer",jl);const Yl=y(rs),Zl=(o,e)=>V(new nn(V(o),e));f("element",Yl);f("convert",Zl);class Ai extends ce{constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const s=e.getTypeLength(t.node.getNodeType(e));return Js.join("").slice(0,s)!==t.components}return!1}generate(e,t){const{targetNode:s,sourceNode:n}=this,i=this.needsSplitAssign(e),r=s.getNodeType(e),a=s.context({assign:!0}).build(e),c=n.build(e,r),l=n.getNodeType(e),u=e.getDataFromNode(this);let p;if(u.initialized===!0)t!=="void"&&(p=a);else if(i){const g=e.getVarFromNode(this,null,r),v=e.getPropertyName(g);e.addLineFlowCode(`${v} = ${c}`);const E=s.node.context({assign:!0}).build(e);for(let R=0;R<s.components.length;R++){const B=s.components[R];e.addLineFlowCode(`${E}.${B} = ${v}[ ${R} ]`)}t!=="void"&&(p=a)}else p=`${a} = ${c}`,(t==="void"||l==="void")&&(e.addLineFlowCode(p),t!=="void"&&(p=a));return u.initialized=!0,e.format(p,r,t)}}const Jl=y(Ai);x("AssignNode",Ai);f("assign",Jl);class Li extends z{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{name:t,node:s}=this,n=this.getNodeType(e),i=e.getVaryingFromNode(this,t,n);i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment");const r=e.getPropertyName(i,In.VERTEX);return e.flowNodeFromShaderStage(In.VERTEX,s,n,r),e.getPropertyName(i)}}const me=y(Li);f("varying",me);x("VaryingNode",Li);class so extends z{constructor(e,t=null){super(t),this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const n=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(n)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),r=e.getTypeFromAttribute(i),a=e.getAttribute(t,r);return e.shaderStage==="vertex"?e.format(a.name,r,s):me(this).build(e,s)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s)}}const Oe=(o,e)=>V(new so(o,e));x("AttributeNode",so);class Ci extends z{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t),this.outputNode.build(e)}}const Ii=y(Ci);f("bypass",Ii);x("BypassNode",Ci);let Kl=0;class Ql{constructor(){this.id=Kl++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}}class Oi extends z{constructor(e,t=new Ql){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const s=e.getCache(),n=this.cache||e.globalCache;e.setCache(n);const i=this.node.build(e,...t);return e.setCache(s),i}}const Ps=y(Oi),eu=o=>Ps(o,null);f("cache",Ps);f("globalCache",eu);x("CacheNode",Oi);class ln extends z{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e);return e.setContext(t),s}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.context});const n=this.node.build(e,t);return e.setContext(s),n}}const Et=y(ln),tu=(o,e)=>Et(o,{label:e});f("context",Et);f("label",tu);x("ContextNode",ln);class gt extends z{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let n;if(s===gt.VERTEX)n=e.getVertexIndex();else if(s===gt.INSTANCE)n=e.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=n:i=me(this).build(e,t),i}}gt.VERTEX="vertex";gt.INSTANCE="instance";const su=w(gt,gt.VERTEX),bi=w(gt,gt.INSTANCE);x("IndexNode",gt);class zi{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class Di extends z{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s}=this,n=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(n),r=t.build(e,n.type);return e.addLineFlowCode(`${i} = ${r}`),i}}const ys=y(Di);f("temp",ys);f("toVar",(...o)=>ys(...o).append());x("VarNode",Di);class Ee extends z{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Ae=(o,e)=>V(new Ee(o,e)),pt=(o,e)=>V(new Ee(o,e,!0)),_e=w(Ee,"vec4","DiffuseColor"),Ns=w(Ee,"float","Roughness"),ou=w(Ee,"float","Metalness"),Go=w(Ee,"float","Clearcoat"),ks=w(Ee,"float","ClearcoatRoughness"),Zt=w(Ee,"vec3","Sheen"),un=w(Ee,"float","SheenRoughness"),dn=w(Ee,"float","Iridescence"),Fi=w(Ee,"float","IridescenceIOR"),Hi=w(Ee,"float","IridescenceThickness"),Tt=w(Ee,"color","SpecularColor"),Bo=w(Ee,"float","Shininess"),nu=w(Ee,"vec4","Output"),ts=w(Ee,"float","dashSize"),Gs=w(Ee,"float","gapSize");w(Ee,"float","pointWidth");x("PropertyNode",Ee);class iu extends Ee{constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}x("ParameterNode",iu);class hn extends z{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}y(hn);x("CodeNode",hn);class ru extends hn{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),n=s.name,i=s.type,r=e.getCodeFromNode(this,i);n!==""&&(r.name=n);const a=e.getPropertyName(r);let c=this.getNodeFunction(e).getCode(a);const l=this.keywords,u=Object.keys(l);if(u.length>0)for(const p of u){const g=new RegExp(`\\b${p}\\b`,"g"),v=l[p].build(e,"property");c=c.replace(g,v)}return r.code=c+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}x("FunctionNode",ru);class pn extends z{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const au=o=>new pn(o),Pi=o=>new pn(o,!0);Pi("frame");Pi("render");const cu=au("object");x("UniformGroupNode",pn);class Gt extends Ks{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.groupNode=cu}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const s=this.getSelf();return e=e.bind(s),super.onUpdate(n=>{const i=e(n,s);i!==void 0&&(this.value=i)},t)}generate(e,t){const s=this.getNodeType(e),n=this.getUniformHash(e);let i=e.getNodeFromHash(n);i===void 0&&(e.setHashNode(this,n),i=this);const r=i.getInputType(e),a=e.getUniformFromNode(i,r,e.shaderStage,e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,t)}}const le=(o,e)=>{const t=Vl(e||o),s=o&&o.isNode===!0?o.node&&o.node.value||o.value:o;return V(new Gt(s,t))};x("UniformNode",Gt);class ki extends so{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){const e=this.index;return"uv"+(e>0?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const yt=(...o)=>V(new ki(...o));x("UVNode",ki);class Gi extends z{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),n=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${n} )`,this.getNodeType(e),t)}}const mn=y(Gi);f("textureSize",mn);x("TextureSizeNode",Gi);class he extends ce{constructor(e,t,s,...n){if(super(),this.op=e,n.length>0){let i=s;for(let r=0;r<n.length;r++)i=new he(e,i,n[r]);s=i}this.aNode=t,this.bNode=s}getNodeType(e,t){const s=this.op,n=this.aNode,i=this.bNode,r=n.getNodeType(e),a=typeof i<"u"?i.getNodeType(e):null;if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(r);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(r),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return r==="float"&&e.isMatrix(a)?a:e.isMatrix(r)&&e.isVector(a)?e.getVectorFromMatrix(r):e.isVector(r)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(r)?a:r}generate(e,t){const s=this.op,n=this.aNode,i=this.bNode,r=this.getNodeType(e,t);let a=null,c=null;r!=="void"?(a=n.getNodeType(e),c=typeof i<"u"?i.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(a)?c=a:a=c="float":s===">>"||s==="<<"?(a=r,c=e.changeComponentType(c,"uint")):e.isMatrix(a)&&e.isVector(c)?c=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(c)?a=e.getVectorFromMatrix(c):a=c=r):a=c=r;const l=n.build(e,a),u=typeof i<"u"?i.build(e,c):null,p=e.getTypeLength(t),g=e.getFunctionOperator(s);if(t!=="void")return s==="<"&&p>1?e.format(`${e.getMethod("lessThan")}( ${l}, ${u} )`,r,t):s==="<="&&p>1?e.format(`${e.getMethod("lessThanEqual")}( ${l}, ${u} )`,r,t):s===">"&&p>1?e.format(`${e.getMethod("greaterThan")}( ${l}, ${u} )`,r,t):s===">="&&p>1?e.format(`${e.getMethod("greaterThanEqual")}( ${l}, ${u} )`,r,t):s==="!"||s==="~"?e.format(`(${s}${l})`,a,t):g?e.format(`${g}( ${l}, ${u} )`,r,t):e.format(`( ${l} ${s} ${u} )`,r,t);if(a!=="void")return g?e.format(`${g}( ${l}, ${u} )`,r,t):e.format(`${l} ${s} ${u}`,r,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Ze=y(he,"+"),ye=y(he,"-"),J=y(he,"*"),is=y(he,"/"),lu=y(he,"%"),uu=y(he,"=="),du=y(he,"!="),hu=y(he,"<"),Bi=y(he,">"),pu=y(he,"<="),mu=y(he,">="),fu=y(he,"&&"),gu=y(he,"||"),Nu=y(he,"!"),yu=y(he,"^^"),Tu=y(he,"&"),xu=y(he,"~"),vu=y(he,"|"),Eu=y(he,"^"),wu=y(he,"<<"),Mu=y(he,">>");f("add",Ze);f("sub",ye);f("mul",J);f("div",is);f("remainder",lu);f("equal",uu);f("notEqual",du);f("lessThan",hu);f("greaterThan",Bi);f("lessThanEqual",pu);f("greaterThanEqual",mu);f("and",fu);f("or",gu);f("not",Nu);f("xor",yu);f("bitAnd",Tu);f("bitNot",xu);f("bitOr",vu);f("bitXor",Eu);f("shiftLeft",wu);f("shiftRight",Mu);x("OperatorNode",he);class m extends ce{constructor(e,t,s=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=n}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(n)?0:e.getTypeLength(n);return i>r&&i>a?t:r>a?s:a>i?n:t}getNodeType(e){const t=this.method;return t===m.LENGTH||t===m.DISTANCE||t===m.DOT?"float":t===m.CROSS?"vec3":t===m.ALL?"bool":t===m.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===m.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){const s=this.method,n=this.getNodeType(e),i=this.getInputType(e),r=this.aNode,a=this.bNode,c=this.cNode,l=e.renderer.isWebGLRenderer===!0;if(s===m.TRANSFORM_DIRECTION){let u=r,p=a;e.isMatrix(u.getNodeType(e))?p=I(N(p),0):u=I(N(u),0);const g=J(u,p).xyz;return Je(g).build(e,t)}else{if(s===m.NEGATE)return e.format("( - "+r.build(e,i)+" )",n,t);if(s===m.ONE_MINUS)return ye(1,r).build(e,t);if(s===m.RECIPROCAL)return is(1,r).build(e,t);if(s===m.DIFFERENCE)return Te(ye(r,a)).build(e,t);{const u=[];return s===m.CROSS||s===m.MOD?u.push(r.build(e,n),a.build(e,n)):s===m.STEP?u.push(r.build(e,e.getTypeLength(r.getNodeType(e))===1?"float":i),a.build(e,i)):l&&(s===m.MIN||s===m.MAX)||s===m.MOD?u.push(r.build(e,i),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":i)):s===m.REFRACT?u.push(r.build(e,i),a.build(e,i),c.build(e,"float")):s===m.MIX?u.push(r.build(e,i),a.build(e,i),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":i)):(u.push(r.build(e,i)),a!==null&&u.push(a.build(e,i)),c!==null&&u.push(c.build(e,i))),e.format(`${e.getMethod(s,n)}( ${u.join(", ")} )`,n,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}m.ALL="all";m.ANY="any";m.EQUALS="equals";m.RADIANS="radians";m.DEGREES="degrees";m.EXP="exp";m.EXP2="exp2";m.LOG="log";m.LOG2="log2";m.SQRT="sqrt";m.INVERSE_SQRT="inversesqrt";m.FLOOR="floor";m.CEIL="ceil";m.NORMALIZE="normalize";m.FRACT="fract";m.SIN="sin";m.COS="cos";m.TAN="tan";m.ASIN="asin";m.ACOS="acos";m.ATAN="atan";m.ABS="abs";m.SIGN="sign";m.LENGTH="length";m.NEGATE="negate";m.ONE_MINUS="oneMinus";m.DFDX="dFdx";m.DFDY="dFdy";m.ROUND="round";m.RECIPROCAL="reciprocal";m.TRUNC="trunc";m.FWIDTH="fwidth";m.BITCAST="bitcast";m.ATAN2="atan2";m.MIN="min";m.MAX="max";m.MOD="mod";m.STEP="step";m.REFLECT="reflect";m.DISTANCE="distance";m.DIFFERENCE="difference";m.DOT="dot";m.CROSS="cross";m.POW="pow";m.TRANSFORM_DIRECTION="transformDirection";m.MIX="mix";m.CLAMP="clamp";m.REFRACT="refract";m.SMOOTHSTEP="smoothstep";m.FACEFORWARD="faceforward";const Ui=d(1e-6);d(1e6);const Hn=d(Math.PI);d(Math.PI*2);const Wi=y(m,m.ALL),Ru=y(m,m.ANY),Su=y(m,m.EQUALS),_u=y(m,m.RADIANS),Vu=y(m,m.DEGREES),Au=y(m,m.EXP),Uo=y(m,m.EXP2),Lu=y(m,m.LOG),fn=y(m,m.LOG2),Bt=y(m,m.SQRT),Cu=y(m,m.INVERSE_SQRT),as=y(m,m.FLOOR),qi=y(m,m.CEIL),Je=y(m,m.NORMALIZE),oo=y(m,m.FRACT),xt=y(m,m.SIN),Rt=y(m,m.COS),Iu=y(m,m.TAN),Ou=y(m,m.ASIN),bu=y(m,m.ACOS),zu=y(m,m.ATAN),Te=y(m,m.ABS),gn=y(m,m.SIGN),Du=y(m,m.LENGTH),Fu=y(m,m.NEGATE),Hu=y(m,m.ONE_MINUS),Pu=y(m,m.DFDX),ku=y(m,m.DFDY),Gu=y(m,m.ROUND),Bu=y(m,m.RECIPROCAL),$i=y(m,m.TRUNC),Uu=y(m,m.FWIDTH);y(m,m.BITCAST);const Wu=y(m,m.ATAN2),Ts=y(m,m.MIN),Ke=y(m,m.MAX),qu=y(m,m.MOD),$u=y(m,m.STEP),Xu=y(m,m.REFLECT),ju=y(m,m.DISTANCE),Yu=y(m,m.DIFFERENCE),cs=y(m,m.DOT),Xi=y(m,m.CROSS),ft=y(m,m.POW),Zu=y(m,m.POW,2),Ju=y(m,m.POW,3),Ku=y(m,m.POW,4),Qu=y(m,m.TRANSFORM_DIRECTION),ed=o=>J(gn(o),ft(Te(o),1/3)),td=o=>cs(o,o),Qe=y(m,m.MIX),xs=(o,e=0,t=1)=>V(new m(m.CLAMP,V(o),V(e),V(t))),sd=o=>xs(o),od=y(m,m.REFRACT),wt=y(m,m.SMOOTHSTEP),nd=y(m,m.FACEFORWARD),id=(o,e,t)=>Qe(e,t,o),rd=(o,e,t)=>wt(e,t,o);f("all",Wi);f("any",Ru);f("equals",Su);f("radians",_u);f("degrees",Vu);f("exp",Au);f("exp2",Uo);f("log",Lu);f("log2",fn);f("sqrt",Bt);f("inverseSqrt",Cu);f("floor",as);f("ceil",qi);f("normalize",Je);f("fract",oo);f("sin",xt);f("cos",Rt);f("tan",Iu);f("asin",Ou);f("acos",bu);f("atan",zu);f("abs",Te);f("sign",gn);f("length",Du);f("lengthSq",td);f("negate",Fu);f("oneMinus",Hu);f("dFdx",Pu);f("dFdy",ku);f("round",Gu);f("reciprocal",Bu);f("trunc",$i);f("fwidth",Uu);f("atan2",Wu);f("min",Ts);f("max",Ke);f("mod",qu);f("step",$u);f("reflect",Xu);f("distance",ju);f("dot",cs);f("cross",Xi);f("pow",ft);f("pow2",Zu);f("pow3",Ju);f("pow4",Ku);f("transformDirection",Qu);f("mix",id);f("clamp",xs);f("refract",od);f("smoothstep",rd);f("faceForward",nd);f("difference",Yu);f("saturate",sd);f("cbrt",ed);x("MathNode",m);const ad=T(o=>{const{value:e}=o,{rgb:t}=e,s=t.mul(.9478672986).add(.0521327014).pow(2.4),n=t.mul(.0773993808),i=t.lessThanEqual(.04045),r=Qe(s,n,i);return I(r,e.a)}),cd=T(o=>{const{value:e}=o,{rgb:t}=e,s=t.pow(.41666).mul(1.055).sub(.055),n=t.mul(12.92),i=t.lessThanEqual(.0031308),r=Qe(s,n,i);return I(r,e.a)}),Pn=o=>{let e=null;return o===Zs?e="Linear":o===Cc&&(e="sRGB"),e},ji=(o,e)=>Pn(o)+"To"+Pn(e);class Ge extends ce{constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){const{method:e,node:t}=this;return e===Ge.LINEAR_TO_LINEAR?t:ld[e]({value:t})}}Ge.LINEAR_TO_LINEAR="LinearToLinear";Ge.LINEAR_TO_sRGB="LinearTosRGB";Ge.sRGB_TO_LINEAR="sRGBToLinear";const ld={[Ge.LINEAR_TO_sRGB]:cd,[Ge.sRGB_TO_LINEAR]:ad},ud=(o,e)=>V(new Ge(ji(Zs,e),V(o))),Yi=(o,e)=>V(new Ge(ji(e,Zs),V(o))),dd=y(Ge,Ge.LINEAR_TO_sRGB),hd=y(Ge,Ge.sRGB_TO_LINEAR);f("linearTosRGB",dd);f("sRGBToLinear",hd);f("linearToColorSpace",ud);f("colorSpaceToLinear",Yi);x("ColorSpaceNode",Ge);class Zi extends z{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),n=this.snippet;if(s==="void")e.addLineFlowCode(n);else return e.format(`( ${n} )`,s,t)}}const no=y(Zi);x("ExpressionNode",Zi);class Ji extends Gt{constructor(e){super(0),this.textureNode=e,this.updateType=ae.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:n,height:i}=s;this.value=Math.log2(Math.max(n,i))}}}const pd=y(Ji);x("MaxMipLevelNode",Ji);class ls extends Gt{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=ae.NONE,this.referenceNode=null,this._value=e,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return yt(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const t=this.value;return le(t.matrix).mul(N(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?ae.FRAME:ae.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(t=t.setY(t.y.oneMinus())),t}setup(e){const t=e.getNodeProperties(this);let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let n=this.levelNode;n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=n,t.compareNode=this.compareNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,n,i,r){const a=this.value;let c;return n?c=e.generateTextureLevel(a,t,s,n,i):r?c=e.generateTextureCompare(a,t,s,r,i):this.sampler===!1?c=e.generateTextureLoad(a,t,s,i):c=e.generateTexture(a,t,s,i),c}generate(e,t){const s=e.getNodeProperties(this),n=this.value;if(!n||n.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const i=super.generate(e,"property");if(t==="sampler")return i+"_sampler";if(e.isReference(t))return i;{const r=e.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:u,levelNode:p,compareNode:g,depthNode:v}=s,E=this.generateUV(e,u),R=p?p.build(e,"float"):null,B=v?v.build(e,"int"):null,k=g?g.build(e,"float"):null,A=e.getVarFromNode(this);a=e.getPropertyName(A);const S=this.generateSnippet(e,i,E,R,B,k);e.addLineFlowCode(`${a} = ${S}`),e.context.tempWrite!==!1&&(r.snippet=S,r.propertyName=a)}let c=a;const l=this.getNodeType(e);return e.needsColorSpaceToLinear(n)&&(c=Yi(no(c,l),n.colorSpace).setup(e).build(e,l)),e.format(c,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=e,t.referenceNode=this,V(t)}blur(e){const t=this.clone();return t.levelNode=e.mul(pd(t)),t.referenceNode=this,V(t)}level(e){const t=this.clone();return t.levelNode=e,t.referenceNode=this,t}size(e){return mn(this,e)}compare(e){const t=this.clone();return t.compareNode=V(e),t.referenceNode=this,V(t)}depth(e){const t=this.clone();return t.depthNode=V(e),t.referenceNode=this,V(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const Ye=y(ls),zt=(...o)=>Ye(...o).setSampler(!1);f("texture",Ye);x("TextureNode",ls);class io extends Gt{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getInputType(){return"buffer"}}const Nn=(o,e,t)=>V(new io(o,e,t));x("BufferNode",io);class md extends rs{constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=super.generate(e),s=this.getNodeType();return e.format(t,"vec4",s)}}class Ki extends io{constructor(e,t=null){super(null,"vec4"),this.array=e,this.elementType=t,this._elementType=null,this._elementLength=0,this.updateType=ae.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:t}=this,s=this.getElementLength(),n=this.getElementType();if(s===1)for(let i=0;i<e.length;i++){const r=i*4;t[r]=e[i]}else if(n==="color")for(let i=0;i<e.length;i++){const r=i*4,a=e[i];t[r]=a.r,t[r+1]=a.g,t[r+2]=a.b||0}else for(let i=0;i<e.length;i++){const r=i*4,a=e[i];t[r]=a.x,t[r+1]=a.y,t[r+2]=a.z||0,t[r+3]=a.w||0}}setup(e){const t=this.array.length;return this._elementType=this.elementType===null?St(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType),this.value=new Float32Array(t*4),this.bufferCount=t,super.setup(e)}element(e){return V(new md(this,V(e)))}}const Wo=(o,e)=>V(new Ki(o,e));x("UniformsNode",Ki);class fd extends rs{constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,s,n)}}class us extends z{constructor(e,t,s=null,n=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=n,this.properties=e.split("."),this.reference=null,this.node=null,this.updateType=ae.OBJECT}element(e){return V(new fd(this,V(e)))}setNodeType(e){let t=null;this.count!==null?t=Nn(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Wo(null,e):e==="texture"?t=Ye(null):t=le(null,e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let n=1;n<t.length;n++)s=s[t[n]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const dt=(o,e,t)=>V(new us(o,e,t)),gd=(o,e,t,s)=>V(new us(o,e,s,t));x("ReferenceNode",us);class Qi extends us{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Nd=(o,e,t)=>V(new Qi(o,e,t));x("MaterialReferenceNode",Qi);class G extends z{constructor(e=G.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=ae.OBJECT,this._uniformNode=new Gt(null)}getNodeType(){const e=this.scope;if(e===G.WORLD_MATRIX||e===G.VIEW_MATRIX)return"mat4";if(e===G.NORMAL_MATRIX)return"mat3";if(e===G.POSITION||e===G.VIEW_POSITION||e===G.DIRECTION||e===G.SCALE)return"vec3"}update(e){const t=this.object3d,s=this._uniformNode,n=this.scope;if(n===G.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(n===G.NORMAL_MATRIX)s.value=t.normalMatrix;else if(n===G.WORLD_MATRIX)s.value=t.matrixWorld;else if(n===G.POSITION)s.value=s.value||new rt,s.value.setFromMatrixPosition(t.matrixWorld);else if(n===G.SCALE)s.value=s.value||new rt,s.value.setFromMatrixScale(t.matrixWorld);else if(n===G.DIRECTION)s.value=s.value||new rt,t.getWorldDirection(s.value);else if(n===G.VIEW_POSITION){const i=e.camera;s.value=s.value||new rt,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}}generate(e){const t=this.scope;return t===G.WORLD_MATRIX||t===G.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===G.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===G.POSITION||t===G.VIEW_POSITION||t===G.DIRECTION||t===G.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}G.VIEW_MATRIX="viewMatrix";G.NORMAL_MATRIX="normalMatrix";G.WORLD_MATRIX="worldMatrix";G.POSITION="position";G.SCALE="scale";G.VIEW_POSITION="viewPosition";G.DIRECTION="direction";y(G,G.DIRECTION);y(G,G.VIEW_MATRIX);y(G,G.NORMAL_MATRIX);y(G,G.WORLD_MATRIX);const qo=y(G,G.POSITION);y(G,G.SCALE);const er=y(G,G.VIEW_POSITION);x("Object3DNode",G);class $ extends G{constructor(e=$.POSITION){super(e),this.updateType=ae.RENDER}getNodeType(e){const t=this.scope;return t===$.PROJECTION_MATRIX||t===$.PROJECTION_MATRIX_INVERSE?"mat4":t===$.NEAR||t===$.FAR||t===$.LOG_DEPTH?"float":super.getNodeType(e)}update(e){const t=e.camera,s=this._uniformNode,n=this.scope;n===$.VIEW_MATRIX?s.value=t.matrixWorldInverse:n===$.PROJECTION_MATRIX?s.value=t.projectionMatrix:n===$.PROJECTION_MATRIX_INVERSE?s.value=t.projectionMatrixInverse:n===$.NEAR?s.value=t.near:n===$.FAR?s.value=t.far:n===$.LOG_DEPTH?s.value=2/(Math.log(t.far+1)/Math.LN2):(this.object3d=t,super.update(e))}generate(e){const t=this.scope;return t===$.PROJECTION_MATRIX||t===$.PROJECTION_MATRIX_INVERSE?this._uniformNode.nodeType="mat4":(t===$.NEAR||t===$.FAR||t===$.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(e)}}$.PROJECTION_MATRIX="projectionMatrix";$.PROJECTION_MATRIX_INVERSE="projectionMatrixInverse";$.NEAR="near";$.FAR="far";$.LOG_DEPTH="logDepth";const vt=w($,$.PROJECTION_MATRIX);w($,$.PROJECTION_MATRIX_INVERSE);const xo=w($,$.NEAR),vo=w($,$.FAR),yd=w($,$.LOG_DEPTH),Lt=w($,$.VIEW_MATRIX);w($,$.NORMAL_MATRIX);w($,$.WORLD_MATRIX);w($,$.POSITION);x("CameraNode",$);class Ie extends G{constructor(e=Ie.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}w(Ie,Ie.DIRECTION);const Pt=w(Ie,Ie.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),tr=w(Ie,Ie.NORMAL_MATRIX),Bs=w(Ie,Ie.WORLD_MATRIX);w(Ie,Ie.POSITION);w(Ie,Ie.SCALE);w(Ie,Ie.VIEW_POSITION);x("ModelNode",Ie);class we extends z{constructor(e=we.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===we.GEOMETRY)e.hasGeometryAttribute("normal")===!1?s=N(0,1,0):s=Oe("normal","vec3");else if(t===we.LOCAL)s=me(Us);else if(t===we.VIEW){const n=tr.mul(ht);s=Je(me(n))}else if(t===we.WORLD){const n=Vt.transformDirection(Lt);s=Je(me(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}we.GEOMETRY="geometry";we.LOCAL="local";we.VIEW="view";we.WORLD="world";const Us=w(we,we.GEOMETRY),ht=w(we,we.LOCAL).temp("Normal"),Vt=w(we,we.VIEW),sr=w(we,we.WORLD),Ne=Ae("vec3","TransformedNormalView"),Td=Ne.transformDirection(Lt).normalize(),Jt=Ae("vec3","TransformedClearcoatNormalView");x("NormalNode",we);const kn=new Map;class M extends z{constructor(e){super(),this.scope=e}getCache(e,t){let s=kn.get(e);return s===void 0&&(s=Nd(e,t),kn.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let n=null;if(s===M.COLOR){const i=this.getColor(s);t.map&&t.map.isTexture===!0?n=i.mul(this.getTexture("map")):n=i}else if(s===M.OPACITY){const i=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?n=i.mul(this.getTexture("alpha")):n=i}else if(s===M.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?n=this.getTexture(s).r:n=d(1);else if(s===M.ROUGHNESS){const i=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).g):n=i}else if(s===M.METALNESS){const i=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?n=i.mul(this.getTexture(s).b):n=i}else if(s===M.EMISSIVE){const i=this.getColor(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?n=i.mul(this.getTexture(s)):n=i}else if(s===M.NORMAL)t.normalMap?n=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?n=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):n=Vt;else if(s===M.CLEARCOAT){const i=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?n=i.mul(this.getTexture(s).r):n=i}else if(s===M.CLEARCOAT_ROUGHNESS){const i=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).r):n=i}else if(s===M.CLEARCOAT_NORMAL)t.clearcoatNormalMap?n=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):n=Vt;else if(s===M.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?n=i.mul(this.getTexture("sheenColor").rgb):n=i}else if(s===M.SHEEN_ROUGHNESS){const i=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).a):n=i,n=n.clamp(.07,1)}else if(s===M.IRIDESCENCE_THICKNESS){const i=dt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const r=dt("0","float",t.iridescenceThicknessRange);n=i.sub(r).mul(this.getTexture(s).g).add(r)}else n=i}else{const i=this.getNodeType(e);n=this.getCache(s,i)}return n}}M.ALPHA_TEST="alphaTest";M.COLOR="color";M.OPACITY="opacity";M.SHININESS="shininess";M.SPECULAR_COLOR="specular";M.SPECULAR_STRENGTH="specularStrength";M.REFLECTIVITY="reflectivity";M.ROUGHNESS="roughness";M.METALNESS="metalness";M.NORMAL="normal";M.CLEARCOAT="clearcoat";M.CLEARCOAT_ROUGHNESS="clearcoatRoughness";M.CLEARCOAT_NORMAL="clearcoatNormal";M.EMISSIVE="emissive";M.ROTATION="rotation";M.SHEEN="sheen";M.SHEEN_ROUGHNESS="sheenRoughness";M.IRIDESCENCE="iridescence";M.IRIDESCENCE_IOR="iridescenceIOR";M.IRIDESCENCE_THICKNESS="iridescenceThickness";M.LINE_SCALE="scale";M.LINE_DASH_SIZE="dashSize";M.LINE_GAP_SIZE="gapSize";M.LINE_WIDTH="linewidth";M.LINE_DASH_OFFSET="dashOffset";M.POINT_WIDTH="pointWidth";const xd=w(M,M.ALPHA_TEST),vs=w(M,M.COLOR),vd=w(M,M.SHININESS),Ed=w(M,M.EMISSIVE),or=w(M,M.OPACITY),wd=w(M,M.SPECULAR_COLOR),Md=w(M,M.SPECULAR_STRENGTH);w(M,M.REFLECTIVITY);const Rd=w(M,M.ROUGHNESS),Sd=w(M,M.METALNESS),_d=w(M,M.NORMAL),Vd=w(M,M.CLEARCOAT),Ad=w(M,M.CLEARCOAT_ROUGHNESS),Ld=w(M,M.CLEARCOAT_NORMAL),Cd=w(M,M.ROTATION),Id=w(M,M.SHEEN),Od=w(M,M.SHEEN_ROUGHNESS),bd=w(M,M.IRIDESCENCE),zd=w(M,M.IRIDESCENCE_IOR),Dd=w(M,M.IRIDESCENCE_THICKNESS),$o=w(M,M.LINE_SCALE),nr=w(M,M.LINE_DASH_SIZE),ir=w(M,M.LINE_GAP_SIZE),Eo=w(M,M.LINE_WIDTH),Gn=w(M,M.LINE_DASH_OFFSET),Fd=w(M,M.POINT_WIDTH);x("MaterialNode",M);class re extends z{constructor(e=re.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===re.GEOMETRY)s=Oe("position","vec3");else if(t===re.LOCAL)s=me(De);else if(t===re.WORLD){const n=Bs.mul(ze);s=me(n)}else if(t===re.VIEW){const n=Pt.mul(ze);s=me(n)}else if(t===re.VIEW_DIRECTION){const n=Xe.negate();s=Je(me(n))}else if(t===re.WORLD_DIRECTION){const n=ze.transformDirection(Bs);s=Je(me(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}re.GEOMETRY="geometry";re.LOCAL="local";re.WORLD="world";re.WORLD_DIRECTION="worldDirection";re.VIEW="view";re.VIEW_DIRECTION="viewDirection";const De=w(re,re.GEOMETRY),ze=w(re,re.LOCAL).temp("Position"),Hd=w(re,re.WORLD),Pd=w(re,re.WORLD_DIRECTION),Xe=w(re,re.VIEW),xe=w(re,re.VIEW_DIRECTION);x("PositionNode",re);class rr extends ce{constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return me(e.context.mvp);const t=this.positionNode||ze;return vt.mul(Pt).mul(t)}}const Bn=y(rr);x("ModelViewProjectionNode",rr);class ar extends Ks{constructor(e,t=null,s=0,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=n,this.usage=Ic,this.instanced=!1,this.attribute=null,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,n=e.getTypeLength(t),i=this.bufferStride||n,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Oc(s,i),c=new bc(a,n,r);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),n=e.getPropertyName(s);let i=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=n,i=n):i=me(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const ro=(o,e,t,s)=>V(new ar(o,e,t,s)),kd=(o,e,t,s)=>ro(o,e,t,s).setUsage(Fo),Un=(o,e,t,s)=>ro(o,e,t,s).setInstanced(!0),Wn=(o,e,t,s)=>kd(o,e,t,s).setInstanced(!0);f("toAttribute",o=>ro(o.value));x("BufferAttributeNode",ar);class cr extends z{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null}setup(){let e=this.instanceMatrixNode;const t=this.instanceMesh;if(e===null){const c=t.instanceMatrix,l=new zc(c.array,16,1),u=c.usage===Fo?Wn:Un,p=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];e=es(...p),this.instanceMatrixNode=e}const s=t.instanceColor;if(s&&this.instanceColorNode===null){const c=new Dc(s.array,3),l=s.usage===Fo?Wn:Un;this.instanceColorNode=N(l(c,"vec3",3,0))}const n=e.mul(ze).xyz,i=ut(e[0].xyz,e[1].xyz,e[2].xyz),r=ht.div(N(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2]))),a=i.mul(r).xyz;ze.assign(n),ht.assign(a),this.instanceColorNode!==null&&pt("vec3","vInstanceColor").assign(this.instanceColorNode)}}const Gd=y(cr);x("InstanceNode",cr);class ve extends z{constructor(e=ve.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===ve.GEOMETRY?"vec4":"vec3"}generate(e){const t=this.scope;let s=null;if(t===ve.GEOMETRY)s=Oe("tangent","vec4"),e.geometry.hasAttribute("tangent")===!1&&e.geometry.computeTangents();else if(t===ve.LOCAL)s=me(Ws.xyz);else if(t===ve.VIEW){const n=Pt.mul(I(ao,0)).xyz;s=Je(me(n))}else if(t===ve.WORLD){const n=co.transformDirection(Lt);s=Je(me(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}ve.GEOMETRY="geometry";ve.LOCAL="local";ve.VIEW="view";ve.WORLD="world";const Ws=w(ve,ve.GEOMETRY),ao=w(ve,ve.LOCAL),co=w(ve,ve.VIEW),Bd=w(ve,ve.WORLD),lr=ys(co,"TransformedTangentView");Je(lr.transformDirection(Lt));x("TangentNode",ve);class ur extends z{constructor(e){super("void"),this.batchMesh=e,this.instanceColorNode=null,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(this.batchingIdNode=Oe("batchId"));const t=this.batchMesh._matricesTexture,s=mn(zt(t),0),n=d(h(this.batchingIdNode)).mul(4).toVar(),i=h(n.mod(s)),r=h(n).div(h(s)),a=es(zt(t,Dt(i,r)),zt(t,Dt(i.add(1),r)),zt(t,Dt(i.add(2),r)),zt(t,Dt(i.add(3),r))),c=ut(a[0].xyz,a[1].xyz,a[2].xyz);ze.assign(a.mul(ze));const l=ht.div(N(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2]))),u=c.mul(l).xyz;ht.assign(u),e.hasGeometryAttribute("tangent")&&ao.mulAssign(c)}}const Ud=y(ur);x("batch",ur);class dr extends z{constructor(e,t=!1){super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=ae.OBJECT,this.skinIndexNode=Oe("skinIndex","uvec4"),this.skinWeightNode=Oe("skinWeight","vec4");let s,n,i;t?(s=dt("bindMatrix","mat4"),n=dt("bindMatrixInverse","mat4"),i=gd("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(s=le(e.bindMatrix,"mat4"),n=le(e.bindMatrixInverse,"mat4"),i=Nn(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=n,this.boneMatricesNode=i}setup(e){const{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:n,bindMatrixInverseNode:i,boneMatricesNode:r}=this,a=r.element(t.x),c=r.element(t.y),l=r.element(t.z),u=r.element(t.w),p=n.mul(ze),g=Ze(a.mul(s.x).mul(p),c.mul(s.y).mul(p),l.mul(s.z).mul(p),u.mul(s.w).mul(p)),v=i.mul(g).xyz;let E=Ze(s.x.mul(a),s.y.mul(c),s.z.mul(l),s.w.mul(u));E=i.mul(E).mul(n);const R=E.transformDirection(ht).xyz;ze.assign(v),ht.assign(R),e.hasGeometryAttribute("tangent")&&ao.assign(R)}generate(e,t){if(t!=="void")return ze.build(e,t)}update(e){(this.useReference?e.object:this.skinnedMesh).skeleton.update()}}const Wd=o=>V(new dr(o,!0));x("SkinningNode",dr);class hr extends z{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let n=0,i=this.params.length-1;n<i;n++){const r=this.params[n],a=r.isNode!==!0&&r.name||this.getVarName(n),c=r.isNode!==!0&&r.type||"int";s[a]=no(a,c)}return t.returnsNode=this.params[this.params.length-1](s,e.addStack(),e),t.stackNode=e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),s={tempWrite:!1},n=this.params,i=t.stackNode;for(let c=0,l=n.length-1;c<l;c++){const u=n[c];let p=null,g=null,v=null,E=null,R=null,B=null;u.isNode?(E="int",v=this.getVarName(c),p="0",g=u.build(e,E),R="<"):(E=u.type||"int",v=u.name||this.getVarName(c),p=u.start,g=u.end,R=u.condition,B=u.update,typeof p=="number"?p=p.toString():p&&p.isNode&&(p=p.build(e,E)),typeof g=="number"?g=g.toString():g&&g.isNode&&(g=g.build(e,E)),p!==void 0&&g===void 0?(p=p+" - 1",g="0",R=">="):g!==void 0&&p===void 0&&(p="0",R="<"),R===void 0&&(Number(p)>Number(g)?R=">=":R="<"));const k={start:p,end:g,condition:R},A=k.start,S=k.end;let ne="",ge="",Y="";B||(E==="int"||E==="uint"?R.includes("<")?B="++":B="--":R.includes("<")?B="+= 1.":B="-= 1."),ne+=e.getVar(E,v)+" = "+A,ge+=v+" "+R+" "+S,Y+=v+" "+B;const C=`for ( ${ne}; ${ge}; ${Y} )`;e.addFlowCode((c===0?`
`:"")+e.tab+C+` {

`).addFlowTab()}const r=Et(i,s).build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let c=0,l=this.params.length-1;c<l;c++)e.addFlowCode((c===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const ue=(...o)=>V(new hr(Qt(o,"int"))).append(),qd=()=>no("break").append();f("loop",(o,...e)=>Ii(o,ue(...e)));x("LoopNode",hr);const wo=new WeakMap,$e=new _t,qn=T(({bufferMap:o,influence:e,stride:t,width:s,depth:n,offset:i})=>{const r=h(su).mul(t).add(i),a=r.div(s),c=r.sub(a.mul(s));return zt(o,Dt(c,a)).depth(n).mul(e)});function $d(o){const e=o.morphAttributes.position!==void 0,t=o.morphAttributes.normal!==void 0,s=o.morphAttributes.color!==void 0,n=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,i=n!==void 0?n.length:0;let r=wo.get(o);if(r===void 0||r.count!==i){let k=function(){R.dispose(),wo.delete(o),o.removeEventListener("dispose",k)};r!==void 0&&r.texture.dispose();const a=o.morphAttributes.position||[],c=o.morphAttributes.normal||[],l=o.morphAttributes.color||[];let u=0;e===!0&&(u=1),t===!0&&(u=2),s===!0&&(u=3);let p=o.attributes.position.count*u,g=1;const v=4096;p>v&&(g=Math.ceil(p/v),p=v);const E=new Float32Array(p*g*4*i),R=new Fc(E,p,g,i);R.type=Hc,R.needsUpdate=!0;const B=u*4;for(let A=0;A<i;A++){const S=a[A],ne=c[A],ge=l[A],Y=p*g*4*A;for(let C=0;C<S.count;C++){const L=C*B;e===!0&&($e.fromBufferAttribute(S,C),E[Y+L+0]=$e.x,E[Y+L+1]=$e.y,E[Y+L+2]=$e.z,E[Y+L+3]=0),t===!0&&($e.fromBufferAttribute(ne,C),E[Y+L+4]=$e.x,E[Y+L+5]=$e.y,E[Y+L+6]=$e.z,E[Y+L+7]=0),s===!0&&($e.fromBufferAttribute(ge,C),E[Y+L+8]=$e.x,E[Y+L+9]=$e.y,E[Y+L+10]=$e.z,E[Y+L+11]=ge.itemSize===4?$e.w:1)}}r={count:i,texture:R,stride:u,size:new at(p,g)},wo.set(o,r),o.addEventListener("dispose",k)}return r}class pr extends z{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=le(1),this.updateType=ae.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,n=t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,r=i!==void 0?i.length:0,{texture:a,stride:c,size:l}=$d(t);s===!0&&ze.mulAssign(this.morphBaseInfluence),n===!0&&ht.mulAssign(this.morphBaseInfluence);const u=h(l.width);ue(r,({i:p})=>{const g=d(0).toVar();this.mesh.isInstancedMesh===!0&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(zt(this.mesh.morphTexture,Dt(h(p).add(1),h(bi))).r):g.assign(dt("morphTargetInfluences","float").element(p).toVar()),s===!0&&ze.addAssign(qn({bufferMap:a,influence:g,stride:c,width:u,depth:p,offset:h(0)})),n===!0&&ht.addAssign(qn({bufferMap:a,influence:g,stride:c,width:u,depth:p,offset:h(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const Xd=y(pr);x("MorphNode",pr);class mr extends z{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return xe.negate().reflect(Ne).transformDirection(Lt)}}const jd=w(mr);x("ReflectVectorNode",mr);class fr extends ls{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return jd}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return e.renderer.coordinateSystem===mi||!s.isRenderTargetTexture?N(t.x.negate(),t.yz):t}generateUV(e,t){return t.build(e,"vec3")}}const gr=y(fr);f("cubeTexture",gr);x("CubeTextureNode",fr);class lo extends z{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}x("LightingNode",lo);let ms=null;class Ut extends lo{constructor(e=null){super(),this.updateType=ae.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.color=new sn,this._defaultColorNode=le(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){let t=this.shadowNode;if(t===null){ms===null&&(ms=e.createNodeMaterial(),ms.fragmentNode=I(0,0,0,1),ms.isShadowNodeMaterial=!0);const s=this.light.shadow,n=e.createRenderTarget(s.mapSize.width,s.mapSize.height),i=new on;i.minFilter=An,i.magFilter=An,i.image.width=s.mapSize.width,i.image.height=s.mapSize.height,i.compareFunction=Pc,n.depthTexture=i,s.camera.updateProjectionMatrix();const r=dt("bias","float",s),a=dt("normalBias","float",s);let c=le(s.matrix).mul(Hd.add(sr.mul(a)));c=c.xyz.div(c.w);const l=c.x.greaterThanEqual(0).and(c.x.lessThanEqual(1)).and(c.y.greaterThanEqual(0)).and(c.y.lessThanEqual(1)).and(c.z.lessThanEqual(1));let u=c.z.add(r);e.renderer.coordinateSystem===mi&&(u=u.mul(2).sub(1)),c=N(c.x,c.y.oneMinus(),u),t=((v,E,R)=>Ye(v,E).compare(R))(i,c.xy,c.z);const g=Ye(n.texture,c);this.rtt=n,this.colorNode=this.colorNode.mul(l.mix(1,t.mix(g.a.mix(1,g),1))),this.shadowNode=t,this.updateBeforeType=ae.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:t,light:s}=this,{renderer:n,scene:i}=e,r=i.overrideMaterial;i.overrideMaterial=ms,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s);const a=n.getRenderTarget(),c=n.getRenderObjectFunction();n.setRenderObjectFunction((l,...u)=>{l.castShadow===!0&&n.renderObject(l,...u)}),n.setRenderTarget(t),n.render(i,s.shadow.camera),n.setRenderTarget(a),n.setRenderObjectFunction(c),i.overrideMaterial=r}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}x("AnalyticLightNode",Ut);const qs=new WeakMap,Yd=o=>o.sort((e,t)=>e.id-t.id);class Zd extends z{constructor(e=[]){super("vec3"),this.totalDiffuseNode=N().temp("totalDiffuse"),this.totalSpecularNode=N().temp("totalSpecular"),this.outgoingLightNode=N().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}setup(e){const t=e.context,s=t.lightingModel;let n=this.outgoingLightNode;if(s){const{lightNodes:i,totalDiffuseNode:r,totalSpecularNode:a}=this;t.outgoingLight=n;const c=e.addStack();s.start(t,c,e);for(const B of i)B.build(e);s.indirectDiffuse(t,c,e),s.indirectSpecular(t,c,e),s.ambientOcclusion(t,c,e);const{backdrop:l,backdropAlpha:u}=t,{directDiffuse:p,directSpecular:g,indirectDiffuse:v,indirectSpecular:E}=t.reflectedLight;let R=p.add(v);l!==null&&(R=N(u!==null?u.mix(R,l):l)),r.assign(R),a.assign(g.add(E)),n.assign(r.add(a)),s.finish(t,c,e),n=n.bypass(e.removeStack())}return n}_getLightNodeById(e){for(const t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){const t=[];e=Yd(e);for(const s of e){let n=this._getLightNodeById(s.id);if(n===null){const i=s.constructor,r=qs.has(i)?qs.get(i):Ut;n=V(new r(s))}t.push(n)}return this.lightNodes=t,this._hash=null,this}}const Jd=y(Zd);function ds(o,e){if(qs.has(o)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof o!="function")throw new Error(`Light ${o.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);qs.set(o,e)}class Nr extends lo{constructor(e=null){super(),this.aoNode=e}setup(e){const s=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(s)}}x("AONode",Nr);class yr extends ln{constructor(e,t=null,s=null,n=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=n,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=N().temp("directDiffuse"),n=N().temp("directSpecular"),i=N().temp("indirectDiffuse"),r=N().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:n,indirectDiffuse:i,indirectSpecular:r};return{radiance:N().temp("radiance"),irradiance:N().temp("irradiance"),iblIrradiance:N().temp("iblIrradiance"),ambientOcclusion:d(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Tr=y(yr);f("lightingContext",Tr);x("LightingContextNode",yr);class yn extends z{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}generate(e,t){const s=this.getNodeType(e),n={tempWrite:!1},i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{ifNode:r,elseNode:a}=this,c=t!=="void",l=c?Ae(s).build(e):"";i.nodeProperty=l;const u=Et(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${u} ) {

`).addFlowTab();let p=Et(r,n).build(e,s);if(p&&(c?p=l+" = "+p+";":p="return "+p+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let g=Et(a,n).build(e,s);g&&(c?g=l+" = "+g+";":g="return "+g+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(l,s,t)}}const je=y(yn);f("cond",je);x("CondNode",yn);const $n=d(1),Xo=d(-2),Is=d(.8),Mo=d(-1),Os=d(.4),Ro=d(2),bs=d(.305),So=d(3),Xn=d(.21),Kd=d(4),jn=d(4),Qd=d(16),eh=T(([o])=>{const e=N(Te(o)).toVar(),t=d(-1).toVar();return Z(e.x.greaterThan(e.z),()=>{Z(e.x.greaterThan(e.y),()=>{t.assign(je(o.x.greaterThan(0),0,3))}).else(()=>{t.assign(je(o.y.greaterThan(0),1,4))})}).else(()=>{Z(e.z.greaterThan(e.y),()=>{t.assign(je(o.z.greaterThan(0),2,5))}).else(()=>{t.assign(je(o.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),th=T(([o,e])=>{const t=H().toVar();return Z(e.equal(0),()=>{t.assign(H(o.z,o.y).div(Te(o.x)))}).elseif(e.equal(1),()=>{t.assign(H(o.x.negate(),o.z.negate()).div(Te(o.y)))}).elseif(e.equal(2),()=>{t.assign(H(o.x.negate(),o.y).div(Te(o.z)))}).elseif(e.equal(3),()=>{t.assign(H(o.z.negate(),o.y).div(Te(o.x)))}).elseif(e.equal(4),()=>{t.assign(H(o.x.negate(),o.z).div(Te(o.y)))}).else(()=>{t.assign(H(o.x,o.y).div(Te(o.z)))}),J(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),sh=T(([o])=>{const e=d(0).toVar();return Z(o.greaterThanEqual(Is),()=>{e.assign($n.sub(o).mul(Mo.sub(Xo)).div($n.sub(Is)).add(Xo))}).elseif(o.greaterThanEqual(Os),()=>{e.assign(Is.sub(o).mul(Ro.sub(Mo)).div(Is.sub(Os)).add(Mo))}).elseif(o.greaterThanEqual(bs),()=>{e.assign(Os.sub(o).mul(So.sub(Ro)).div(Os.sub(bs)).add(Ro))}).elseif(o.greaterThanEqual(Xn),()=>{e.assign(bs.sub(o).mul(Kd.sub(So)).div(bs.sub(Xn)).add(So))}).else(()=>{e.assign(d(-2).mul(fn(J(1.16,o))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]});T(([o,e])=>{const t=o.toVar();t.assign(J(2,t).sub(1));const s=N(t,1).toVar();return Z(e.equal(0),()=>{s.assign(s.zyx)}).elseif(e.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).elseif(e.equal(2),()=>{s.x.mulAssign(-1)}).elseif(e.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).elseif(e.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).elseif(e.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]});const oh=T(([o,e,t,s,n,i])=>{const r=d(t),a=N(e),c=xs(sh(r),Xo,i),l=oo(c),u=as(c),p=N(jo(o,a,u,s,n,i)).toVar();return Z(l.notEqual(0),()=>{const g=N(jo(o,a,u.add(1),s,n,i)).toVar();p.assign(Qe(p,g,l))}),p}),jo=T(([o,e,t,s,n,i])=>{const r=d(t).toVar(),a=N(e),c=d(eh(a)).toVar(),l=d(Ke(jn.sub(r),0)).toVar();r.assign(Ke(r,jn));const u=d(Uo(r)).toVar(),p=H(th(a,c).mul(u.sub(2)).add(1)).toVar();return Z(c.greaterThan(2),()=>{p.y.addAssign(u),c.subAssign(3)}),p.x.addAssign(c.mul(u)),p.x.addAssign(l.mul(J(3,Qd))),p.y.addAssign(J(4,Uo(i).sub(u))),p.x.mulAssign(s),p.y.mulAssign(n),o.uv(p)}),_o=T(({envMap:o,mipInt:e,outputDirection:t,theta:s,axis:n,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:r,CUBEUV_MAX_MIP:a})=>{const c=Rt(s),l=t.mul(c).add(n.cross(t).mul(xt(s))).add(n.mul(n.dot(t).mul(c.oneMinus())));return jo(o,l,e,i,r,a)});T(({n:o,latitudinal:e,poleAxis:t,outputDirection:s,weights:n,samples:i,dTheta:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p})=>{const g=N(je(e,t,Xi(t,s))).toVar();Z(Wi(g.equals(N(0))),()=>{g.assign(N(s.z,0,s.x.negate()))}),g.assign(Je(g));const v=N().toVar();return v.addAssign(n.element(h(0)).mul(_o({theta:0,axis:g,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p}))),ue({start:h(1),end:o},({i:E})=>{Z(E.greaterThanEqual(i),()=>{qd()});const R=d(r.mul(d(E))).toVar();v.addAssign(n.element(E).mul(_o({theta:R.mul(-1),axis:g,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p}))),v.addAssign(n.element(E).mul(_o({theta:R,axis:g,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p})))}),I(v,1)});let $s=null;const Yn=new WeakMap;function nh(o){const e=Math.log2(o)-2,t=1/o;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function ih(o){let e=Yn.get(o);if((e!==void 0?e.pmremVersion:-1)!==o.pmremVersion){if(o.isCubeTexture){if(o.source.data.some(s=>s===void 0))throw new Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");e=$s.fromCubemap(o,e)}else{if(o.image===void 0)throw new Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");e=$s.fromEquirectangular(o,e)}e.pmremVersion=o.pmremVersion,Yn.set(o,e)}return e.texture}class xr extends ce{constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null,this._texture=Ye(null),this._width=le(0),this._height=le(0),this._maxMip=le(0),this.updateBeforeType=ae.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=nh(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem;const t=e?e.pmremVersion:-1,s=this._value;t!==s.pmremVersion&&(s.isPMREMTexture===!0?e=s:e=ih(s),this._pmrem=e,this.updateFromTexture(e))}setup(e){$s===null&&($s=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this));const s=this.value;e.renderer.coordinateSystem===kc&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(t=N(t.x.negate(),t.yz));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),oh(this._texture,t,n,this._width,this._height,this._maxMip)}}const rh=y(xr);x("PMREMNode",xr);const Zn=new WeakMap;class vr extends lo{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode){let l=Zn.get(t.value);l===void 0&&(l=rh(t.value),Zn.set(t.value,l)),t=l}const n=e.material.envMap?dt("envMapIntensity","float",e.material):dt("environmentIntensity","float",e.scene),i=Et(t,Jn(Ns,Ne)).mul(n),r=Et(t,ah(Td)).mul(Math.PI).mul(n),a=Ps(i);e.context.radiance.addAssign(a),e.context.iblIrradiance.addAssign(r);const c=e.context.lightingModel.clearcoatRadiance;if(c){const l=Et(t,Jn(ks,Jt)).mul(n),u=Ps(l);c.addAssign(u)}}}const Jn=(o,e)=>{let t=null;return{getUV:()=>(t===null&&(t=xe.negate().reflect(e),t=o.mul(o).mix(t,e).normalize(),t=t.transformDirection(Lt)),t),getTextureLevel:()=>o}},ah=o=>({getUV:()=>o,getTextureLevel:()=>d(1)});x("EnvironmentNode",vr);let Vo,Ao;class se extends z{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===se.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=ae.NONE;return(this.scope===se.RESOLUTION||this.scope===se.VIEWPORT)&&(e=ae.FRAME),this.updateType=e,e}update({renderer:e}){this.scope===se.VIEWPORT?e.getViewport(Ao):e.getDrawingBufferSize(Vo)}setup(){const e=this.scope;let t=null;if(e===se.RESOLUTION)t=le(Vo||(Vo=new at));else if(e===se.VIEWPORT)t=le(Ao||(Ao=new _t));else{t=ch.div(Kn);let s=t.x,n=t.y;/bottom/i.test(e)&&(n=n.oneMinus()),/right/i.test(e)&&(s=s.oneMinus()),t=H(s,n)}return t}generate(e){if(this.scope===se.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(Kn).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}se.COORDINATE="coordinate";se.RESOLUTION="resolution";se.VIEWPORT="viewport";se.TOP_LEFT="topLeft";se.BOTTOM_LEFT="bottomLeft";se.TOP_RIGHT="topRight";se.BOTTOM_RIGHT="bottomRight";const ch=w(se,se.COORDINATE),Kn=w(se,se.RESOLUTION),ss=w(se,se.VIEWPORT),Es=w(se,se.TOP_LEFT);w(se,se.BOTTOM_LEFT);w(se,se.TOP_RIGHT);w(se,se.BOTTOM_RIGHT);x("ViewportNode",se);const fs=new at;class Ss extends ls{constructor(e=Es,t=null,s=null){s===null&&(s=new fi,s.minFilter=Gc),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=ae.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(fs);const s=this.value;(s.image.width!==fs.width||s.image.height!==fs.height)&&(s.image.width=fs.width,s.image.height=fs.height,s.needsUpdate=!0);const n=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=n}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}const lh=y(Ss),uh=y(Ss,null,null,{generateMipmaps:!0});f("viewportTexture",lh);f("viewportMipTexture",uh);x("ViewportTextureNode",Ss);let Lo=null;class Er extends Ss{constructor(e=Es,t=null){Lo===null&&(Lo=new on),super(e,t,Lo)}}const wr=y(Er);f("viewportDepthTexture",wr);x("ViewportDepthTextureNode",Er);class Le extends z{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Le.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){const{scope:e}=this;let t=null;if(e===Le.DEPTH)t=Yo(Xe.z,xo,vo);else if(e===Le.DEPTH_TEXTURE){const s=this.valueNode||wr(),n=Mr(s,xo,vo);t=Yo(n,xo,vo)}else e===Le.DEPTH_PIXEL&&this.valueNode!==null&&(t=Rr().assign(this.valueNode));return t}}const Yo=(o,e,t)=>o.add(e).div(e.sub(t)),Mr=(o,e,t)=>e.mul(t).div(t.sub(e).mul(o).sub(t));Le.DEPTH="depth";Le.DEPTH_TEXTURE="depthTexture";Le.DEPTH_PIXEL="depthPixel";const Rr=y(Le,Le.DEPTH_PIXEL);w(Le,Le.DEPTH);y(Le,Le.DEPTH_TEXTURE);const Sr=w(Le,Le.DEPTH_PIXEL);Sr.assign=o=>Rr(o);x("ViewportDepthNode",Le);class At extends z{constructor(e=At.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{localClipIntersection:s,localClippingCount:n,globalClippingCount:i}=t,r=i+n,a=s?r-n:r;return this.scope===At.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(t.planes,r,a):this.setupDefault(t.planes,r,a)}setupAlphaToCoverage(e,t,s){return T(()=>{const n=Wo(e),i=Ae("float","distanceToPlane"),r=Ae("float","distanceToGradient"),a=Ae("float","clipOpacity");a.assign(1);let c;if(ue(s,({i:l})=>{c=n.element(l),i.assign(Xe.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),a.mulAssign(wt(r.negate(),r,i)),a.equal(0).discard()}),s<t){const l=Ae("float","unionclipOpacity");l.assign(1),ue({start:s,end:t},({i:u})=>{c=n.element(u),i.assign(Xe.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),l.mulAssign(wt(r.negate(),r,i).oneMinus())}),a.mulAssign(l.oneMinus())}_e.a.mulAssign(a),_e.a.equal(0).discard()})()}setupDefault(e,t,s){return T(()=>{const n=Wo(e);let i;if(ue(s,({i:r})=>{i=n.element(r),Xe.dot(i.xyz).greaterThan(i.w).discard()}),s<t){const r=Ae("bool","clipped");r.assign(!0),ue({start:s,end:t},({i:a})=>{i=n.element(a),r.assign(Xe.dot(i.xyz).greaterThan(i.w).and(r))}),r.discard()}})()}}At.ALPHA_TO_COVERAGE="alphaToCoverage";At.DEFAULT="default";const dh=()=>V(new At),hh=()=>V(new At(At.ALPHA_TO_COVERAGE));class _r extends z{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}const ph=w(_r),Xs=d(ph).mul(2).sub(1);x("FrontFacingNode",_r);const Zo=new Map;class ot extends Bc{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpaced=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Ti(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;const s=this.setupClipping(e);if(this.fragmentNode===null){this.depthWrite===!0&&this.setupDepth(e),this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const n=this.setupLighting(e);s!==null&&e.stack.add(s);const i=I(n,_e.a).max(0);t=this.setupOutput(e,i),nu.assign(t),this.outputNode!==null&&(t=this.outputNode)}else t=this.setupOutput(e,this.fragmentNode);e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupClipping(e){const{globalClippingCount:t,localClippingCount:s}=e.clippingContext;let n=null;return(t||s)&&(this.alphaToCoverage?n=hh():e.stack.add(dh())),n}setupDepth(e){const{renderer:t}=e;let s=this.depthNode;s===null&&t.logarithmicDepthBuffer===!0&&(s=Bn().w.add(1).log2().mul(yd).mul(.5)),s!==null&&Sr.assign(s).append()}setupPosition(e){const{object:t}=e,s=t.geometry;e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&Xd(t).append(),t.isSkinnedMesh===!0&&Wd(t).append(),t.isBatchedMesh&&Ud(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&e.isAvailable("instance")===!0&&Gd(t).append(),this.positionNode!==null&&ze.assign(this.positionNode);const n=Bn();return e.context.vertex=e.removeStack(),e.context.mvp=n,n}setupDiffuseColor({object:e,geometry:t}){let s=this.colorNode?I(this.colorNode):vs;this.vertexColors===!0&&t.hasAttribute("color")&&(s=I(s.xyz.mul(Oe("color","vec3")),s.a)),e.instanceColor&&(s=pt("vec3","vInstanceColor").mul(s)),_e.assign(s);const n=this.opacityNode?d(this.opacityNode):or;if(_e.a.assign(_e.a.mul(n)),this.alphaTestNode!==null||this.alphaTest>0){const i=this.alphaTestNode!==null?d(this.alphaTestNode):xd;_e.a.lessThanEqual(i).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=Xe.dFdx().cross(Xe.dFdy()).normalize();Ne.assign(e.mul(Xs))}else{const e=this.normalNode?N(this.normalNode):_d;Ne.assign(e.mul(Xs))}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?gr(this.envMap):Ye(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){const t=this.getEnvNode(e),s=[];t&&s.push(new vr(t)),e.material.aoMap&&s.push(new Nr(Ye(e.material.aoMap)));let n=this.lightsNode||e.lightsNode;return s.length>0&&(n=Jd([...n.lightNodes,...s])),n}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:n,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=_e.rgb;if(a&&a.hasLight!==!1){const l=this.setupLightingModel(e);c=Tr(a,l,s,n)}else s!==null&&(c=N(n!==null?Qe(c,s,n):s));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(c=c.add(N(i||Ed))),c}setupOutput(e,t){const s=e.renderer;if(this.fog===!0){const i=e.fogNode;i&&(t=I(i.mix(t.rgb,i.colorNode),t.a))}const n=e.toneMappingNode;if(this.toneMapped===!0&&n&&(t=I(n.context({color:t.rgb}),t.a)),this.colorSpaced===!0){const i=s.currentColorSpace;i!==Zs&&i!==Uc&&(t=t.linearToColorSpace(i))}return t}setDefaultValues(e){for(const s in e){const n=e[s];this[s]===void 0&&(this[s]=n,n&&n.clone&&(this[s]=n.clone()))}Object.assign(this.defines,e.defines);const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=Wc.prototype.toJSON.call(this,e),n=Hs(this);s.inputNodes={};for(const{property:r,childNode:a}of n)s.inputNodes[r]=a.toJSON(e).uuid;function i(r){const a=[];for(const c in r){const l=r[c];delete l.metadata,a.push(l)}return a}if(t){const r=i(e.textures),a=i(e.images),c=i(e.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const t=e.type.replace("Material","NodeMaterial"),s=mh(t);if(s===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const n in e)s[n]=e[n];return s}}function Be(o,e){if(typeof e!="function"||!o)throw new Error(`Node material ${o} is not a class`);if(Zo.has(o)){console.warn(`Redefinition of node material ${o}`);return}Zo.set(o,e),e.type=o}function mh(o){const e=Zo.get(o);if(e!==void 0)return new e}Be("NodeMaterial",ot);class Vr extends z{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){const s=new gs(t);return this._currentCond=je(e,s),this.add(this._currentCond)}elseif(e,t){const s=new gs(t),n=je(e,s);return this._currentCond.elseNode=n,this._currentCond=n,this}else(e){return this._currentCond.elseNode=new gs(e),this}build(e,...t){const s=Al();Fn(this);for(const n of this.nodes)n.build(e,"void");return Fn(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}y(Vr);x("StackNode",Vr);class Ar extends ce{constructor(e=Pd){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return H(t,s)}}y(Ar);x("EquirectUVNode",Ar);class Lr extends z{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}x("StructTypeNode",Lr);class Cr extends z{constructor(...e){super(),this.isOutputStructNode=!0,this.members=e}setup(e){super.setup(e);const t=this.members,s=[];for(let n=0;n<t.length;n++)s.push(t[n].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new Lr(s)).name}generate(e,t){const s=e.getVarFromNode(this);s.isOutputStructVar=!0;const n=e.getPropertyName(s),i=this.members,r=n!==""?n+".":"";for(let a=0;a<i.length;a++){const c=i[a].build(e,t);e.addLineFlowCode(`${r}m${a} = ${c}`)}return n}}y(Cr);x("OutputStructNode",Cr);class Ir extends z{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.uint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).float().mul(1/2**32)}}const fh=y(Ir);f("hash",fh);x("HashNode",Ir);const Jo=(o,e)=>ft(J(4,o.mul(ye(1,o))),e),gh=(o,e)=>o.lessThan(.5)?Jo(o.mul(2),e).div(2):ye(1,Jo(J(ye(1,o),2),e).div(2)),Nh=(o,e,t)=>ft(is(ft(o,e),Ze(ft(o,e),ft(ye(1,o),t))),1/e),yh=(o,e)=>xt(Hn.mul(e.mul(o).sub(1))).div(Hn.mul(e.mul(o).sub(1)));f("parabola",Jo);f("gain",gh);f("pcurve",Nh);f("sinc",yh);const mt=T(([o])=>o.fract().sub(.5).abs()),Or=T(([o])=>N(mt(o.z.add(mt(o.y.mul(1)))),mt(o.z.add(mt(o.x.mul(1)))),mt(o.y.add(mt(o.x.mul(1)))))),Th=T(([o,e,t])=>{const s=N(o).toVar(),n=d(1.4).toVar(),i=d(0).toVar(),r=N(s).toVar();return ue({start:d(0),end:d(3),type:"float",condition:"<="},()=>{const a=N(Or(r.mul(2))).toVar();s.addAssign(a.add(t.mul(d(.1).mul(e)))),r.mulAssign(1.8),n.mulAssign(1.5),s.mulAssign(1.2);const c=d(mt(s.z.add(mt(s.x.add(mt(s.y)))))).toVar();i.addAssign(c.div(n)),r.addAssign(.14)}),i});mt.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]});Or.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Th.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});let Co;class br extends yn{constructor(e){Co=Co||no("discard"),super(e,Co)}}const xh=y(br),vh=o=>xh(o).append();f("discard",vh);x("DiscardNode",br);class zr extends z{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let n=null,i=-1;for(const r of this.functionNodes){const c=r.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const l=c.inputs;if(t.length===l.length){let u=0;for(let p=0;p<t.length;p++){const g=t[p],v=l[p];g.getNodeType(e)===v.type?u++:u=0}u>i&&(n=r,i=u)}}this._candidateFnCall=s=n(...t)}return s}}const Eh=y(zr),nt=o=>(...e)=>Eh(o,...e);x("FunctionOverloadingNode",zr);class Dr extends ce{constructor(){super("vec2")}setup(){const e=N(xe.z,0,xe.x.negate()).normalize(),t=xe.cross(e);return H(e.dot(Ne),t.dot(Ne)).mul(.495).add(.5)}}w(Dr);x("MatcapUVNode",Dr);class Pe extends Gt{constructor(e=Pe.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=ae.FRAME}update(e){const t=this.scope,s=this.scale;t===Pe.LOCAL?this.value+=e.deltaTime*s:t===Pe.DELTA?this.value=e.deltaTime*s:t===Pe.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Pe.LOCAL="local";Pe.GLOBAL="global";Pe.DELTA="delta";Pe.FRAME="frame";const wh=(o,e=0)=>V(new Pe(Pe.LOCAL,o,e));w(Pe,Pe.FRAME).uint();x("TimerNode",Pe);class Me extends z{constructor(e=Me.SINE,t=wh()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=V(this.timeNode);let s=null;return e===Me.SINE?s=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===Me.SQUARE?s=t.fract().round():e===Me.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===Me.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Me.SINE="sine";Me.SQUARE="square";Me.TRIANGLE="triangle";Me.SAWTOOTH="sawtooth";y(Me,Me.SINE);y(Me,Me.SQUARE);y(Me,Me.TRIANGLE);y(Me,Me.SAWTOOTH);x("OscNode",Me);class Nt extends ce{constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:t}=this;let s=null;return e===Nt.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===Nt.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}Nt.DIRECTION_TO_COLOR="directionToColor";Nt.COLOR_TO_DIRECTION="colorToDirection";const Fr=y(Nt,Nt.DIRECTION_TO_COLOR),Mh=y(Nt,Nt.COLOR_TO_DIRECTION);f("directionToColor",Fr);f("colorToDirection",Mh);x("PackingNode",Nt);class Tn extends z{constructor(e,t,s,n=d(0),i=d(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=n,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:n,outHighNode:i,doClamp:r}=this;let a=e.sub(t).div(s.sub(t));return r===!0&&(a=a.clamp()),a.mul(i.sub(n)).add(n)}}const Rh=y(Tn,null,null,{doClamp:!1}),Sh=y(Tn);f("remap",Rh);f("remapClamp",Sh);x("RemapNode",Tn);class Hr extends ce{constructor(e,t,s=H(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){const{uvNode:e,rotationNode:t,centerNode:s}=this;return e.sub(s).rotate(t).add(s)}}const _h=y(Hr);f("rotateUV",_h);x("RotateUVNode",Hr);class Pr extends ce{constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:s}=this;if(this.getNodeType(e)==="vec2"){const i=t.cos(),r=t.sin();return Vi(i,r,r.negate(),i).mul(s)}else{const i=t,r=es(I(1,0,0,0),I(0,Rt(i.x),xt(i.x).negate(),0),I(0,xt(i.x),Rt(i.x),0),I(0,0,0,1)),a=es(I(Rt(i.y),0,xt(i.y),0),I(0,1,0,0),I(xt(i.y).negate(),0,Rt(i.y),0),I(0,0,0,1)),c=es(I(Rt(i.z),xt(i.z).negate(),0,0),I(xt(i.z),Rt(i.z),0,0),I(0,0,1,0),I(0,0,0,1));return r.mul(a).mul(c).mul(I(s,1)).xyz}}}const Vh=y(Pr);f("rotate",Vh);x("RotateNode",Pr);class kr extends z{constructor(e,t=yt(),s=d(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){const{frameNode:e,uvNode:t,countNode:s}=this,{width:n,height:i}=s,r=e.mod(n.mul(i)).floor(),a=r.mod(n),c=i.sub(r.add(1).div(n).ceil()),l=s.reciprocal(),u=H(a,c);return t.add(u).mul(l)}}y(kr);x("SpriteSheetUVNode",kr);class Gr extends rs{constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return e.isAvailable("storageBuffer")===!1&&!this.node.instanceIndex&&this.node.bufferObject===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let s;const n=e.context.assign;if(e.isAvailable("storageBuffer")===!1){const{node:i}=this;!i.instanceIndex&&this.node.bufferObject===!0&&n!==!0?s=e.generatePBO(this):s=i.build(e)}else s=super.generate(e);if(n!==!0){const i=this.getNodeType(e);s=e.format(s,i,t)}return s}}const Br=y(Gr);f("storageElement",Br);x("StorageArrayElementNode",Gr);class Ur extends z{constructor(e,t=null,s=null,n=d(1),i=ze,r=ht){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=n,this.positionNode=i,this.normalNode=r}setup(){const{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:n,positionNode:i,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(N(1)));const c=i.yz.mul(n),l=i.zx.mul(n),u=i.xy.mul(n),p=e.value,g=t!==null?t.value:p,v=s!==null?s.value:p,E=Ye(p,c).mul(a.x),R=Ye(g,l).mul(a.y),B=Ye(v,u).mul(a.z);return Ze(E,R,B)}}const Ah=y(Ur),Lh=(...o)=>Ah(...o);f("triplanarTexture",Lh);x("TriplanarTexturesNode",Ur);new qc;new rt;new rt;new rt;new di;new rt(0,0,-1);new _t;new rt;new rt;new _t;new at;new Ft;H(Es.x.oneMinus(),Es.y);class Re extends z{constructor(e=Re.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){const t=this.scope;let s;t===Re.GEOMETRY?s=Us.cross(Ws):t===Re.LOCAL?s=ht.cross(ao):t===Re.VIEW?s=Vt.cross(co):t===Re.WORLD&&(s=sr.cross(Bd));const n=s.mul(Ws.w).xyz;return Je(me(n)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Re.GEOMETRY="geometry";Re.LOCAL="local";Re.VIEW="view";Re.WORLD="world";w(Re,Re.GEOMETRY);w(Re,Re.LOCAL);const Ch=w(Re,Re.VIEW);w(Re,Re.WORLD);const Ih=Je(Ne.cross(lr).mul(Ws.w));Je(Ih.transformDirection(Lt));x("BitangentNode",Re);const Wr=ut(co,Ch,Vt);xe.mul(Wr);class Oh extends so{constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),s=e.hasGeometryAttribute(t);let n;return s===!0?n=super.generate(e):n=e.generateConst(this.nodeType,new _t(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}x("VertexColorNode",Oh);class qr extends us{constructor(e,t,s=null){super(e,t,s),this.renderer=s}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const bh=(o,e,t)=>V(new qr(o,e,t));x("RendererReferenceNode",qr);const uo=1/6,$r=o=>J(uo,J(o,J(o,o.negate().add(3)).sub(3)).add(1)),Ko=o=>J(uo,J(o,J(o,J(3,o).sub(6))).add(4)),Xr=o=>J(uo,J(o,J(o,J(-3,o).add(3)).add(3)).add(1)),Qo=o=>J(uo,ft(o,3)),Qn=o=>$r(o).add(Ko(o)),ei=o=>Xr(o).add(Qo(o)),ti=o=>Ze(-1,Ko(o).div($r(o).add(Ko(o)))),si=o=>Ze(1,Qo(o).div(Xr(o).add(Qo(o)))),oi=(o,e,t)=>{const s=o.uvNode,n=J(s,e.zw).add(.5),i=as(n),r=oo(n),a=Qn(r.x),c=ei(r.x),l=ti(r.x),u=si(r.x),p=ti(r.y),g=si(r.y),v=H(i.x.add(l),i.y.add(p)).sub(.5).mul(e.xy),E=H(i.x.add(u),i.y.add(p)).sub(.5).mul(e.xy),R=H(i.x.add(l),i.y.add(g)).sub(.5).mul(e.xy),B=H(i.x.add(u),i.y.add(g)).sub(.5).mul(e.xy),k=Qn(r.y).mul(Ze(a.mul(o.uv(v).level(t)),c.mul(o.uv(E).level(t)))),A=ei(r.y).mul(Ze(a.mul(o.uv(R).level(t)),c.mul(o.uv(B).level(t))));return k.add(A)},zh=(o,e)=>{const t=H(o.size(h(e))),s=H(o.size(h(e.add(1)))),n=is(1,t),i=is(1,s),r=oi(o,I(n,t),as(e)),a=oi(o,I(i,s),qi(e));return oo(e).mix(r,a)};class jr extends ce{constructor(e,t=d(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return zh(this.textureNode,this.blurNode)}}const Dh=y(jr);f("bicubic",Dh);x("TextureBicubicNode",jr);class Yr extends z{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}w(Yr);x("PointUVNode",Yr);class ct extends z{constructor(e=ct.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let n;return t===ct.BACKGROUND_BLURRINESS?n=dt("backgroundBlurriness","float",s):t===ct.BACKGROUND_INTENSITY?n=dt("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",t),n}}ct.BACKGROUND_BLURRINESS="backgroundBlurriness";ct.BACKGROUND_INTENSITY="backgroundIntensity";w(ct,ct.BACKGROUND_BLURRINESS);w(ct,ct.BACKGROUND_INTENSITY);x("SceneNode",ct);class Fh extends io{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0,this.bufferObject=!1,this._attribute=null,this._varying=null}getInputType(){return"storageBuffer"}element(e){return Br(this,e)}setBufferObject(e){return this.bufferObject=e,this}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);const t=this.getNodeType(e);this._attribute===null&&(this._attribute=ro(this.value),this._varying=me(this._attribute));const s=this._varying.build(e,t);return e.registerTransform(s,this._attribute),s}}x("StorageBufferNode",Fh);class Zr extends ls{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStoreTextureNode=!0}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);t.storeNode=this.storeNode}generate(e,t){let s;return this.storeNode!==null?s=this.generateStore(e):s=super.generate(e,t),s}generateStore(e){const t=e.getNodeProperties(this),{uvNode:s,storeNode:n}=t,i=super.generate(e,"property"),r=s.build(e,"uvec2"),a=n.build(e,"vec4"),c=e.generateTextureStore(e,i,r,a);e.addLineFlowCode(c)}}y(Zr);x("TextureStoreNode",Zr);class Hh extends us{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}x("UserDataNode",Hh);const Ph=T(({base:o,blend:e})=>{const t=s=>e[s].lessThan(Ui).cond(e[s],o[s].oneMinus().div(e[s]).oneMinus().max(0));return N(t("x"),t("y"),t("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),kh=T(({base:o,blend:e})=>{const t=s=>e[s].equal(1).cond(e[s],o[s].div(e[s].oneMinus()).max(0));return N(t("x"),t("y"),t("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Gh=T(({base:o,blend:e})=>{const t=s=>o[s].oneMinus().mul(e[s].oneMinus()).oneMinus();return N(t("x"),t("y"),t("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Bh=T(({base:o,blend:e})=>{const t=s=>o[s].lessThan(.5).cond(o[s].mul(e[s],2),o[s].oneMinus().mul(e[s].oneMinus()).oneMinus());return N(t("x"),t("y"),t("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class Ve extends ce{constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){const{blendMode:e,baseNode:t,blendNode:s}=this,n={base:t,blend:s};let i=null;return e===Ve.BURN?i=Ph(n):e===Ve.DODGE?i=kh(n):e===Ve.SCREEN?i=Gh(n):e===Ve.OVERLAY&&(i=Bh(n)),i}}Ve.BURN="burn";Ve.DODGE="dodge";Ve.SCREEN="screen";Ve.OVERLAY="overlay";const Uh=y(Ve,Ve.BURN),Wh=y(Ve,Ve.DODGE),qh=y(Ve,Ve.OVERLAY),$h=y(Ve,Ve.SCREEN);f("burn",Uh);f("dodge",Wh);f("overlay",qh);f("screen",$h);x("BlendModeNode",Ve);const Xh=T(({textureNode:o,bumpScale:e})=>{let t=o;if(t.isTextureNode!==!0&&t.traverse(r=>{r.isTextureNode===!0&&(t=r)}),t.isTextureNode!==!0)throw new Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");const s=d(o),n=t.uvNode||yt(),i=r=>o.cache().context({getUV:()=>r,forceUVContext:!0});return H(d(i(n.add(n.dFdx()))).sub(s),d(i(n.add(n.dFdy()))).sub(s)).mul(e)}),jh=T(o=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=o,n=e.dFdx().normalize(),i=e.dFdy().normalize(),r=t,a=i.cross(r),c=r.cross(n),l=n.dot(a).mul(Xs),u=l.sign().mul(s.x.mul(a).add(s.y.mul(c)));return l.abs().mul(t).sub(u).normalize()});class Jr extends ce{constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Xh({textureNode:this.textureNode,bumpScale:e});return jh({surf_pos:Xe,surf_norm:Vt,dHdxy:t})}}const Yh=y(Jr);f("bumpMap",Yh);x("BumpMapNode",Jr);const Zh=T(({color:o,adjustment:e})=>e.mix(Kr(o.rgb),o.rgb)),Jh=T(({color:o,adjustment:e})=>{const t=Ze(o.r,o.g,o.b).div(3),s=o.r.max(o.g.max(o.b)),n=s.sub(t).mul(e).mul(-3);return Qe(o.rgb,s,n)}),Kh=T(({color:o,adjustment:e})=>{const t=N(.57735,.57735,.57735),s=e.cos();return N(o.rgb.mul(s).add(t.cross(o.rgb).mul(e.sin()).add(t.mul(cs(t,o.rgb).mul(s.oneMinus())))))});class ke extends ce{constructor(e,t,s=d(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){const{method:e,colorNode:t,adjustmentNode:s}=this,n={color:t,adjustment:s};let i=null;return e===ke.SATURATION?i=Zh(n):e===ke.VIBRANCE?i=Jh(n):e===ke.HUE?i=Kh(n):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}ke.SATURATION="saturation";ke.VIBRANCE="vibrance";ke.HUE="hue";const Qh=y(ke,ke.SATURATION),ep=y(ke,ke.VIBRANCE),tp=y(ke,ke.HUE),sp=N(.2125,.7154,.0721),Kr=(o,e=sp)=>cs(o,e),Qr=(o,e)=>Qe(N(0),o,Kr(o).sub(e).max(0));f("saturation",Qh);f("vibrance",ep);f("hue",tp);f("threshold",Qr);x("ColorAdjustmentNode",ke);const op=T(o=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:n}=o,i=e.dFdx(),r=e.dFdy(),a=n.dFdx(),c=n.dFdy(),l=t,u=r.cross(l),p=l.cross(i),g=u.mul(a.x).add(p.mul(c.x)),v=u.mul(a.y).add(p.mul(c.y)),E=g.dot(g).max(v.dot(v)),R=Xs.mul(E.inverseSqrt());return Ze(g.mul(s.x,R),v.mul(s.y,R),l.mul(s.z)).normalize()});class ea extends ce{constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Ln}setup(e){const{normalMapType:t,scaleNode:s}=this;let n=this.node.mul(2).sub(1);s!==null&&(n=N(n.xy.mul(s),n.z));let i=null;return t===$c?i=tr.mul(n).normalize():t===Ln&&(e.hasGeometryAttribute("tangent")===!0?i=Wr.mul(n).normalize():i=op({eye_pos:Xe,surf_norm:Vt,mapN:n,uv:yt()})),i}}const np=y(ea);f("normalMap",np);x("NormalMapNode",ea);class ta extends ce{constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const ip=y(ta);f("posterize",ip);x("PosterizeNode",ta);const rp=T(({color:o,exposure:e})=>o.mul(e).clamp()),ap=T(({color:o,exposure:e})=>(o=o.mul(e),o.div(o.add(1)).clamp())),cp=T(({color:o,exposure:e})=>{o=o.mul(e),o=o.sub(.004).max(0);const t=o.mul(o.mul(6.2).add(.5)),s=o.mul(o.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}),lp=T(({color:o})=>{const e=o.mul(o.add(.0245786)).sub(90537e-9),t=o.mul(o.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),up=T(({color:o,exposure:e})=>{const t=ut(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=ut(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return o=o.mul(e).div(.6),o=t.mul(o),o=lp({color:o}),o=s.mul(o),o.clamp()}),dp=ut(N(1.6605,-.1246,-.0182),N(-.5876,1.1329,-.1006),N(-.0728,-.0083,1.1187)),hp=ut(N(.6274,.0691,.0164),N(.3293,.9195,.088),N(.0433,.0113,.8956)),pp=T(([o])=>{const e=N(o).toVar(),t=N(e.mul(e)).toVar(),s=N(t.mul(t)).toVar();return d(15.5).mul(s.mul(t)).sub(J(40.14,s.mul(e))).add(J(31.96,s).sub(J(6.868,t.mul(e))).add(J(.4298,t).add(J(.1191,e).sub(.00232))))}),mp=T(({color:o,exposure:e})=>{const t=N(o).toVar(),s=ut(N(.856627153315983,.137318972929847,.11189821299995),N(.0951212405381588,.761241990602591,.0767994186031903),N(.0482516061458583,.101439036467562,.811302368396859)),n=ut(N(1.1271005818144368,-.1413297634984383,-.14132976349843826),N(-.11060664309660323,1.157823702216272,-.11060664309660294),N(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=d(-12.47393),r=d(4.026069);return t.mulAssign(e),t.assign(hp.mul(t)),t.assign(s.mul(t)),t.assign(Ke(t,1e-10)),t.assign(fn(t)),t.assign(t.sub(i).div(r.sub(i))),t.assign(xs(t,0,1)),t.assign(pp(t)),t.assign(n.mul(t)),t.assign(ft(Ke(N(0),t),N(2.2))),t.assign(dp.mul(t)),t.assign(xs(t,0,1)),t}),fp={[Xc]:rp,[jc]:ap,[Yc]:cp,[Zc]:up,[Jc]:mp};class sa extends ce{constructor(e=Ho,t=Np,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===Ho)return t;const n={exposure:this.exposureNode,color:t},i=fp[s];let r=null;return i?r=i(n):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}const gp=(o,e,t)=>V(new sa(o,V(e),V(t))),Np=bh("toneMappingExposure","float");f("toneMapping",(o,e,t)=>gp(e,t,o));x("ToneMappingNode",sa);let Io=null;class oa extends Ss{constructor(e=Es,t=null){Io===null&&(Io=new fi),super(e,t,Io)}updateReference(){return this}}const yp=y(oa);f("viewportSharedTexture",yp);x("ViewportSharedTextureNode",oa);class en extends ls{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class _s extends ce{constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const n=new on;n.isRenderTargetTexture=!0,n.name="PostProcessingDepth";const i=new Ft(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Kc});i.texture.name="PostProcessing",i.depthTexture=n,this.renderTarget=i,this.updateBeforeType=ae.FRAME,this._textureNode=V(new en(this,i.texture)),this._depthTextureNode=V(new en(this,n)),this._depthNode=null,this._viewZNode=null,this._cameraNear=le(0),this._cameraFar=le(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getViewZNode(){if(this._viewZNode===null){const e=this._cameraNear,t=this._cameraFar;this._viewZNode=Mr(this._depthTextureNode,e,t)}return this._viewZNode}getDepthNode(){if(this._depthNode===null){const e=this._cameraNear,t=this._cameraFar;this._depthNode=Yo(this.getViewZNode(),e,t)}return this._depthNode}setup(){return this.scope===_s.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s,camera:n}=this;this._pixelRatio=t.getPixelRatio();const i=t.getSize(new at);this.setSize(i.width,i.height);const r=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget();this._cameraNear.value=n.near,this._cameraFar.value=n.far,t.toneMapping=Ho,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,n),t.toneMapping=r,t.toneMappingNode=a,t.setRenderTarget(c)}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget.setSize(s,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}_s.COLOR="color";_s.DEPTH="depth";const xn=(o,e)=>V(new en(o,e));x("PassNode",_s);const Oo=new Qc(-1,1,1,-1,0,1);class Tp extends tl{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Cn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Cn(t,2))}}const xp=new Tp;class ho extends el{constructor(e=null){super(xp,e),this.camera=Oo}renderAsync(e){return e.renderAsync(this,Oo)}render(e){e.render(this,Oo)}}const ni=new ho,ii=new ho;class vp extends ce{constructor(e,t=2){super("vec4"),this.textureNode=e,this.sigma=t,this.directionNode=H(1),this._invSize=le(new at),this._passDirection=le(new at),this._horizontalRT=new Ft,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new Ft,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=xn(this,this._verticalRT.texture),this.updateBeforeType=ae.RENDER,this.resolution=new at(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value,i=t.getRenderTarget(),r=s.value;ni.material=this._material,ii.material=this._material,this.setSize(n.image.width,n.image.height);const a=n.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),ni.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),ii.render(t),t.setRenderTarget(i),s.value=r}getTextureNode(){return this._textureNode}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),I();const s=t.uvNode||yt(),n=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=T(()=>{const c=3+2*this.sigma,l=this._getCoefficients(c),u=this._invSize,p=H(this.directionNode).mul(this._passDirection),g=d(l[0]).toVar(),v=I(n(s).mul(g)).toVar();for(let E=1;E<c;E++){const R=d(E),B=d(l[E]),k=H(p.mul(u.mul(R))).toVar(),A=I(n(s.add(k))),S=I(n(s.sub(k)));v.addAssign(A.add(S).mul(B)),g.addAssign(J(2,B))}return v.div(g)}),r=this._material||(this._material=e.createNodeMaterial());r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}_getCoefficients(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}const Ep=(o,e)=>V(new vp(V(o),e));f("gaussianBlur",Ep);const ri=new ho;class wp extends ce{constructor(e,t=.96){super(e),this.textureNode=e,this.textureNodeOld=Ye(),this.damp=le(t),this._compRT=new Ft,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new Ft,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=xn(this,this._compRT.texture),this.updateBeforeType=ae.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._compRT.setSize(e,t),this._oldRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value,i=n.type;this._compRT.texture.type=i,this._oldRT.texture.type=i;const r=t.getRenderTarget(),a=s.value;this.textureNodeOld.value=this._oldRT.texture,t.setRenderTarget(this._compRT),ri.render(t);const c=this._oldRT;this._oldRT=this._compRT,this._compRT=c,this.setSize(n.image.width,n.image.height),t.setRenderTarget(r),s.value=a}setup(e){const t=this.textureNode,s=this.textureNodeOld;if(t.isTextureNode!==!0)return console.error("AfterImageNode requires a TextureNode."),I();const n=t.uvNode||yt();s.uvNode=n;const i=u=>t.cache().context({getUV:()=>u,forceUVContext:!0}),r=T(([u,p])=>{const g=d(p).toVar(),v=I(u).toVar();return Ke(gn(v.sub(g)),0)}),a=T(()=>{const u=I(s),p=I(i(n));return u.mulAssign(this.damp.mul(r(u,.1))),Ke(p,u)}),c=this._materialComposed||(this._materialComposed=e.createNodeMaterial());c.fragmentNode=a(),ri.material=c;const l=e.getNodeProperties(this);return l.textureNode=t,this._textureNode}}const Mp=(o,e)=>V(new wp(V(o),e));f("afterImage",Mp);const ai=new ho;class Rp extends ce{constructor(e,t,s,n){super("vec4"),this.textureNode=e,this.tresholdNode=t,this.scaleNode=s,this.colorNode=N(.1,0,1),this.samples=n,this.resolution=new at(1,1),this._renderTarget=new Ft,this._renderTarget.texture.name="anamorphic",this._invSize=le(new at),this._textureNode=xn(this,this._renderTarget.texture),this.updateBeforeType=ae.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._invSize.value.set(1/e,1/t),e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._renderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value;this._renderTarget.texture.type=n.type;const i=t.getRenderTarget(),r=s.value;ai.material=this._material,this.setSize(n.image.width,n.image.height),t.setRenderTarget(this._renderTarget),ai.render(t),t.setRenderTarget(i),s.value=r}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("AnamorphNode requires a TextureNode."),I();const s=t.uvNode||yt(),n=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=T(()=>{const c=this.samples,l=Math.floor(c/2),u=N(0).toVar();return ue({start:-l,end:l},({i:p})=>{const g=d(p).abs().div(l).oneMinus(),v=H(s.x.add(this._invSize.x.mul(p).mul(this.scaleNode)),s.y),E=n(v),R=Qr(E,this.tresholdNode).mul(g);u.addAssign(R)}),u.mul(this.colorNode)}),r=this._material||(this._material=e.createNodeMaterial());r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}}const Sp=(o,e=.9,t=3,s=32)=>V(new Rp(V(o),V(e),V(t),s));f("anamorphic",Sp);class na extends ce{constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,n=s.getInputs(e),i=this.parameters;if(Array.isArray(i))for(let a=0;a<i.length;a++){const c=n[a],l=i[a];t.push(l.build(e,c.type))}else for(const a of n){const c=i[a.name];if(c!==void 0)t.push(c.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const _p=(o,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Qt(e):to(e[0]),V(new na(V(o),e)));f("call",_p);x("FunctionCallNode",na);class ia extends z{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new hi,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:d()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=vi(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=Ei(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const Ds=y(ia);f("scriptableValue",Ds);x("ScriptableValueNode",ia);class ra extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(t!==null){const n=t(...s);return this.set(e,n),n}}}class Vp{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const bo=new ra;class aa extends z{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new ra,this._output=Ds(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const s=this._outputs;return s[e]===void 0?s[e]=Ds(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=Ds(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n(...t)}async callAsync(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n.constructor.name==="AsyncFunction"?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(l,u)=>this.setOutput(l,u),s=new Vp(this),n=bo.get("THREE"),i=bo.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,bo,e,t,n,i];this._object=r(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const l of c.elements){const u=l.id||l.name;l.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=l.inputType),l.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=l.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let s=this.parameters[t];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:d()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),n="var "+s+`; var output = {};
`,i=`
return { ...output, `+s+" };",r=n+this.codeNode.code+i;return this._method=new Function(...e,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Ap=y(aa);f("scriptable",Ap);x("ScriptableNode",aa);class po extends z{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}getViewZNode(e){let t;const s=e.context.getViewZ;return s!==void 0&&(t=s(this)),(t||Xe.z).negate()}setup(){return this.factorNode}}const Lp=y(po);f("fog",Lp);x("FogNode",po);class ca extends po{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(e){const t=this.getViewZNode(e);return wt(this.nearNode,this.farNode,t)}}const Cp=y(ca);f("rangeFog",Cp);x("FogRangeNode",ca);class la extends po{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(e){const t=this.getViewZNode(e),s=this.densityNode;return s.mul(s,t,t).negate().exp().oneMinus()}}const Ip=y(la);f("densityFog",Ip);x("FogExp2Node",la);let It=null,Ot=null;class ua extends z{constructor(e=d(),t=d()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(St(this.minNode.value)),s=e.getTypeLength(St(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.isInstancedMesh===!0?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let s=null;if(t.isInstancedMesh===!0){const n=this.minNode.value,i=this.maxNode.value,r=e.getTypeLength(St(n)),a=e.getTypeLength(St(i));It=It||new _t,Ot=Ot||new _t,It.setScalar(0),Ot.setScalar(0),r===1?It.setScalar(n):n.isColor?It.set(n.r,n.g,n.b):It.set(n.x,n.y,n.z||0,n.w||0),a===1?Ot.setScalar(i):i.isColor?Ot.set(i.r,i.g,i.b):Ot.set(i.x,i.y,i.z||0,i.w||0);const c=4,l=c*t.count,u=new Float32Array(l);for(let g=0;g<l;g++){const v=g%c,E=It.getComponent(v),R=Ot.getComponent(v);u[g]=pi.lerp(E,R,Math.random())}const p=this.getNodeType(e);s=Nn(u,"vec4",t.count).element(bi).convert(p)}else s=d(0);return s}}y(ua);x("RangeNode",ua);class da extends z{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=ae.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let n=1;n<t.length;n++)s*=t[n];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s)}}}const Op=(o,e,t)=>V(new da(V(o),e,t));f("compute",Op);x("ComputeNode",da);class kt extends z{constructor(e=kt.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){const{scope:e,light:t}=this;let s=null;return e===kt.TARGET_DIRECTION&&(s=Lt.transformDirection(qo(t).sub(qo(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}kt.TARGET_DIRECTION="targetDirection";const ha=y(kt,kt.TARGET_DIRECTION);x("LightNode",kt);const pa=T(o=>{const{lightDistance:e,cutoffDistance:t,decayExponent:s}=o,n=e.pow(s).max(.01).reciprocal();return t.greaterThan(0).cond(n.mul(e.div(t).pow4().oneMinus().clamp().pow2()),n)});class ma extends Ut{constructor(e=null){super(e),this.cutoffDistanceNode=le(0),this.decayExponentNode=le(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:n,light:i}=this,r=e.context.lightingModel,a=er(i).sub(Xe),c=a.normalize(),l=a.length(),u=pa({lightDistance:l,cutoffDistance:s,decayExponent:n}),p=t.mul(u),g=e.context.reflectedLight;r.direct({lightDirection:c,lightColor:p,reflectedLight:g},e.stack,e)}}x("PointLightNode",ma);ds(sl,ma);class fa extends Ut{constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,s=this.colorNode,n=ha(this.light),i=e.context.reflectedLight;t.direct({lightDirection:n,lightColor:s,reflectedLight:i},e.stack,e)}}x("DirectionalLightNode",fa);ds(ol,fa);class vn extends Ut{constructor(e=null){super(e),this.coneCosNode=le(0),this.penumbraCosNode=le(0),this.cutoffDistanceNode=le(0),this.decayExponentNode=le(0)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:s}=this;return wt(t,s,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:n,decayExponentNode:i,light:r}=this,a=er(r).sub(Xe),c=a.normalize(),l=c.dot(ha(r)),u=this.getSpotAttenuation(l),p=a.length(),g=pa({lightDistance:p,cutoffDistance:n,decayExponent:i}),v=s.mul(u).mul(g),E=e.context.reflectedLight;t.direct({lightDirection:c,lightColor:v,reflectedLight:E},e.stack,e)}}x("SpotLightNode",vn);ds(gi,vn);class bp extends gi{constructor(e,t,s,n,i,r){super(e,t,s,n,i,r),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}const zp=bp;class ga extends vn{getSpotAttenuation(e){const t=this.light.iesMap;let s=null;if(t&&t.isTexture===!0){const n=e.acos().mul(1/Math.PI);s=Ye(t,H(n,0),0).r}else s=super.getSpotAttenuation(e);return s}}x("IESSpotLightNode",ga);ds(zp,ga);class Na extends Ut{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}x("AmbientLightNode",Na);ds(nl,Na);class ya extends Ut{constructor(e=null){super(e),this.lightPositionNode=qo(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=le(new sn)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:n}=this,r=Vt.dot(n).mul(.5).add(.5),a=Qe(s,t,r);e.context.irradiance.addAssign(a)}}x("HemisphereLightNode",ya);ds(il,ya);const Dp=T(o=>{const e=o.uv.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()});class Ta extends ce{constructor(e=yt()){super("float"),this.uvNode=e}setup(){return Dp({uv:this.uvNode})}}const Fp=y(Ta);f("checker",Fp);x("CheckerNode",Ta);const Hp=new Ni;class Pp extends ot{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(Hp),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor;this.vertexNode=T(()=>{me(H(),"vUv").assign(yt());const s=Oe("instancePosition"),n=Ae("vec4","mvPos");n.assign(Pt.mul(I(s,1)));const i=ss.z.div(ss.w),r=vt.mul(n),a=Ae("vec2","offset");return a.assign(De.xy),a.assign(a.mul(Fd)),a.assign(a.div(ss.z)),a.y.assign(a.y.mul(i)),a.assign(a.mul(r.w)),r.assign(r.add(I(a,0,0))),r})(),this.fragmentNode=T(()=>{const s=me(H(),"vUv"),n=Ae("float","alpha");n.assign(1);const i=s.x,r=s.y,a=i.mul(i).add(r.mul(r));if(e){const l=Ae("float","dlen");l.assign(a.fwidth()),n.assign(wt(l.oneMinus(),l.add(1),a).oneMinus())}else a.greaterThan(1).discard();let c;return this.pointColorNode?c=this.pointColorNode:t?c=Oe("instanceColor").mul(vs):c=vs,I(c,n)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Be("InstancedPointsNodeMaterial",Pp);const kp=new rl;class Gp extends ot{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(kp),this.setValues(e)}}Be("LineBasicNodeMaterial",Gp);const Bp=new yi;class Up extends ot{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Bp),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?d(this.dashScaleNode):$o,s=this.dashSizeNode?d(this.dashSizeNode):nr,n=this.dashSizeNode?d(this.dashGapNode):ir;ts.assign(s),Gs.assign(n);const i=me(Oe("lineDistance").mul(t));(e?i.add(e):i).mod(ts.add(Gs)).greaterThan(ts).discard()}}Be("LineDashedNodeMaterial",Up);const Wp=new yi;class qp extends ot{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(Wp),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor,s=this.dashed,n=this.worldUnits,i=T(({start:a,end:c})=>{const l=vt.element(2).element(2),g=vt.element(3).element(2).mul(-.5).div(l).sub(a.z).div(c.z.sub(a.z));return I(Qe(a.xyz,c.xyz,g),c.w)});this.vertexNode=T(()=>{pt("vec2","vUv").assign(yt());const a=Oe("instanceStart"),c=Oe("instanceEnd"),l=Ae("vec4","start"),u=Ae("vec4","end");l.assign(Pt.mul(I(a,1))),u.assign(Pt.mul(I(c,1))),n&&(pt("vec3","worldStart").assign(l.xyz),pt("vec3","worldEnd").assign(u.xyz));const p=ss.z.div(ss.w),g=vt.element(2).element(3).equal(-1);Z(g,()=>{Z(l.z.lessThan(0).and(u.z.greaterThan(0)),()=>{u.assign(i({start:l,end:u}))}).elseif(u.z.lessThan(0).and(l.z.greaterThanEqual(0)),()=>{l.assign(i({start:u,end:l}))})});const v=vt.mul(l),E=vt.mul(u),R=v.xyz.div(v.w),B=E.xyz.div(E.w),k=B.xy.sub(R.xy).temp();k.x.assign(k.x.mul(p)),k.assign(k.normalize());const A=ys(I());if(n){const S=u.xyz.sub(l.xyz).normalize(),ne=Qe(l.xyz,u.xyz,.5).normalize(),ge=S.cross(ne).normalize(),Y=S.cross(ge),C=pt("vec4","worldPos");C.assign(De.y.lessThan(.5).cond(l,u));const L=Eo.mul(.5);C.addAssign(I(De.x.lessThan(0).cond(ge.mul(L),ge.mul(L).negate()),0)),s||(C.addAssign(I(De.y.lessThan(.5).cond(S.mul(L).negate(),S.mul(L)),0)),C.addAssign(I(Y.mul(L),0)),Z(De.y.greaterThan(1).or(De.y.lessThan(0)),()=>{C.subAssign(I(Y.mul(2).mul(L),0))})),A.assign(vt.mul(C));const P=ys(N());P.assign(De.y.lessThan(.5).cond(R,B)),A.z.assign(P.z.mul(A.w))}else{const S=Ae("vec2","offset");S.assign(H(k.y,k.x.negate())),k.x.assign(k.x.div(p)),S.x.assign(S.x.div(p)),S.assign(De.x.lessThan(0).cond(S.negate(),S)),Z(De.y.lessThan(0),()=>{S.assign(S.sub(k))}).elseif(De.y.greaterThan(1),()=>{S.assign(S.add(k))}),S.assign(S.mul(Eo)),S.assign(S.div(ss.w)),A.assign(De.y.lessThan(.5).cond(v,E)),S.assign(S.mul(A.w)),A.assign(A.add(I(S,0,0)))}return A})();const r=T(({p1:a,p2:c,p3:l,p4:u})=>{const p=a.sub(l),g=u.sub(l),v=c.sub(a),E=p.dot(g),R=g.dot(v),B=p.dot(v),k=g.dot(g),S=v.dot(v).mul(k).sub(R.mul(R)),ge=E.mul(R).sub(B.mul(k)).div(S).clamp(),Y=E.add(R.mul(ge)).div(k).clamp();return H(ge,Y)});this.fragmentNode=T(()=>{const a=pt("vec2","vUv");if(s){const u=this.offsetNode?d(this.offsetNodeNode):Gn,p=this.dashScaleNode?d(this.dashScaleNode):$o,g=this.dashSizeNode?d(this.dashSizeNode):nr,v=this.dashSizeNode?d(this.dashGapNode):ir;ts.assign(g),Gs.assign(v);const E=Oe("instanceDistanceStart"),R=Oe("instanceDistanceEnd"),B=De.y.lessThan(.5).cond(p.mul(E),$o.mul(R)),k=me(B.add(Gn)),A=u?k.add(u):k;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),A.mod(ts.add(Gs)).greaterThan(ts).discard()}const c=Ae("float","alpha");if(c.assign(1),n){const u=pt("vec3","worldStart"),p=pt("vec3","worldEnd"),g=pt("vec4","worldPos").xyz.normalize().mul(1e5),v=p.sub(u),E=r({p1:u,p2:p,p3:N(0,0,0),p4:g}),R=u.add(v.mul(E.x)),B=g.mul(E.y),S=R.sub(B).length().div(Eo);if(!s)if(e){const ne=S.fwidth();c.assign(wt(ne.negate().add(.5),ne.add(.5),S).oneMinus())}else S.greaterThan(.5).discard()}else if(e){const u=a.x,p=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),g=u.mul(u).add(p.mul(p)),v=Ae("float","dlen");v.assign(g.fwidth()),Z(a.y.abs().greaterThan(1),()=>{c.assign(wt(v.oneMinus(),v.add(1),g).oneMinus())})}else Z(a.y.abs().greaterThan(1),()=>{const u=a.x,p=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));u.mul(u).add(p.mul(p)).greaterThan(1).discard()});let l;if(this.lineColorNode)l=this.lineColorNode;else if(t){const u=Oe("instanceColorStart"),p=Oe("instanceColorEnd");l=De.y.lessThan(.5).cond(u,p).mul(vs)}else l=vs;return I(l,c)})(),this.needsUpdate=!0}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.setupShaders())}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.setupShaders())}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Be("Line2NodeMaterial",qp);const $p=new al;class Xp extends ot{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpaced=!1,this.setDefaultValues($p),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?d(this.opacityNode):or;_e.assign(I(Fr(Ne),e))}}Be("MeshNormalNodeMaterial",Xp);const jp=new cl;class Yp extends ot{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(jp),this.setValues(e)}}Be("MeshBasicNodeMaterial",Yp);const ws=T(({f0:o,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return o.mul(s.oneMinus()).add(e.mul(s))}),js=T(o=>o.diffuseColor.mul(1/Math.PI)),Zp=()=>d(.25),Jp=T(({dotNH:o})=>Bo.mul(.5/Math.PI).add(1).mul(o.pow(Bo))),Kp=T(({lightDirection:o})=>{const e=o.add(xe).normalize(),t=Ne.dot(e).clamp(),s=xe.dot(e).clamp(),n=ws({f0:Tt,f90:1,dotVH:s}),i=Zp(),r=Jp({dotNH:t});return n.mul(i).mul(r)});class xa extends zi{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=Ne.dot(e).clamp().mul(t);s.directDiffuse.addAssign(i.mul(js({diffuseColor:_e.rgb}))),this.specular===!0&&s.directSpecular.addAssign(i.mul(Kp({lightDirection:e})).mul(Md))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(js({diffuseColor:_e})))}}const Qp=new ll;class em extends ot{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Qp),this.setValues(e)}setupLightingModel(){return new xa(!1)}}Be("MeshLambertNodeMaterial",em);const tm=new ul;class sm extends ot{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(tm),this.setValues(e)}setupLightingModel(){return new xa}setupVariants(){const e=(this.shininessNode?d(this.shininessNode):vd).max(1e-4);Bo.assign(e);const t=this.specularNode||wd;Tt.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}Be("MeshPhongNodeMaterial",sm);const om=T(()=>{const o=Us.dFdx().abs().max(Us.dFdy().abs());return o.x.max(o.y).max(o.z)}),nm=T(o=>{const{roughness:e}=o,t=om();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),im=T(o=>{const{alpha:e,dotNL:t,dotNV:s}=o,n=e.pow2(),i=t.mul(n.add(n.oneMinus().mul(s.pow2())).sqrt()),r=s.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt());return is(.5,i.add(r).max(Ui))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),rm=T(({alpha:o,dotNH:e})=>{const t=o.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),ci=T(o=>{const{lightDirection:e,f0:t,f90:s,roughness:n,iridescenceFresnel:i}=o,r=o.normalView||Ne,a=n.pow2(),c=e.add(xe).normalize(),l=r.dot(e).clamp(),u=r.dot(xe).clamp(),p=r.dot(c).clamp(),g=xe.dot(c).clamp();let v=ws({f0:t,f90:s,dotVH:g});i&&(v=dn.mix(v,i));const E=im({alpha:a,dotNL:l,dotNV:u}),R=rm({alpha:a,dotNH:p});return v.mul(E).mul(R)}),va=T(({roughness:o,dotNV:e})=>{const t=I(-1,-.0275,-.572,.022),s=I(1,.0425,1.04,-.04),n=o.mul(t).add(s),i=n.x.mul(n.x).min(e.mul(-9.28).exp2()).mul(n.x).add(n.y);return H(-1.04,1.04).mul(i).add(n.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),am=T(o=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:n}=o,i=va({dotNV:e,roughness:n});return t.mul(i.x).add(s.mul(i.y))}),cm=T(({f:o,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),n=s.mul(s),i=s.mul(n,n).clamp(0,.9999);return o.sub(N(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),lm=T(({roughness:o,dotNH:e})=>{const t=o.pow2(),s=d(1).div(t),i=e.pow2().oneMinus().max(.0078125);return d(2).add(s).mul(i.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),um=T(({dotNV:o,dotNL:e})=>d(1).div(d(4).mul(e.add(o).sub(e.mul(o))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),dm=T(({lightDirection:o})=>{const e=o.add(xe).normalize(),t=Ne.dot(o).clamp(),s=Ne.dot(xe).clamp(),n=Ne.dot(e).clamp(),i=lm({roughness:un,dotNH:n}),r=um({dotNV:s,dotNL:t});return Zt.mul(i).mul(r)}),hm=ut(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),pm=o=>{const e=o.sqrt();return N(1).add(e).div(N(1).sub(e))},li=(o,e)=>o.sub(e).div(o.add(e)).pow2(),mm=(o,e)=>{const t=o.mul(2*Math.PI*1e-9),s=N(54856e-17,44201e-17,52481e-17),n=N(1681e3,1795300,2208400),i=N(43278e5,93046e5,66121e5),r=d(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(i.mul(2*Math.PI).sqrt()).mul(n.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=N(a.x.add(r),a.y,a.z).div(10685e-11),hm.mul(a)},fm=T(({outsideIOR:o,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:n})=>{const i=Qe(o,e,wt(0,.03,s)),r=o.div(i).pow2().mul(d(1).sub(t.pow2())),c=d(1).sub(r).sqrt(),l=li(i,o),u=ws({f0:l,f90:1,dotVH:t}),p=u.oneMinus(),g=i.lessThan(o).cond(Math.PI,0),v=d(Math.PI).sub(g),E=pm(n.clamp(0,.9999)),R=li(E,i.vec3()),B=ws({f0:R,f90:1,dotVH:c}),k=N(E.x.lessThan(i).cond(Math.PI,0),E.y.lessThan(i).cond(Math.PI,0),E.z.lessThan(i).cond(Math.PI,0)),A=i.mul(s,c,2),S=N(v).add(k),ne=u.mul(B).clamp(1e-5,.9999),ge=ne.sqrt(),Y=p.pow2().mul(B).div(N(1).sub(ne));let L=u.add(Y),P=Y.sub(p);for(let D=1;D<=2;++D){P=P.mul(ge);const O=mm(d(D).mul(A),d(D).mul(S)).mul(2);L=L.add(P.mul(O))}return L.max(N(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),gm=T(({normal:o,viewDir:e,roughness:t})=>{const s=o.dot(e).saturate(),n=t.pow2(),i=je(t.lessThan(.25),d(-339.2).mul(n).add(d(161.4).mul(t)).sub(25.9),d(-8.48).mul(n).add(d(14.3).mul(t)).sub(9.95)),r=je(t.lessThan(.25),d(44).mul(n).sub(d(23.7).mul(t)).add(3.26),d(1.97).mul(n).sub(d(3.27).mul(t)).add(.72));return je(t.lessThan(.25),0,d(.1).mul(t).sub(.025)).add(i.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),zo=N(.04),Do=N(1);class En extends zi{constructor(e=!1,t=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(){if(this.clearcoat===!0&&(this.clearcoatRadiance=N().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=N().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=N().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=N().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=N().temp("sheenSpecularIndirect")),this.iridescence===!0){const e=Ne.dot(xe).clamp();this.iridescenceFresnel=fm({outsideIOR:d(1),eta2:Fi,cosTheta1:e,thinFilmThickness:Hi,baseF0:Tt}),this.iridescenceF0=cm({f:this.iridescenceFresnel,f90:1,dotVH:e})}}computeMultiscattering(e,t,s=d(1)){const n=Ne.dot(xe).clamp(),i=va({roughness:Ns,dotNV:n}),a=(this.iridescenceF0?dn.mix(Tt,this.iridescenceF0):Tt).mul(i.x).add(s.mul(i.y)),l=i.x.add(i.y).oneMinus(),u=Tt.add(Tt.oneMinus().mul(.047619)),p=a.mul(u).div(l.mul(u).oneMinus());e.addAssign(a),t.addAssign(p.mul(l))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=Ne.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(dm({lightDirection:e}))),this.clearcoat===!0){const a=Jt.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(ci({lightDirection:e,f0:zo,f90:Do,roughness:ks,normalView:Jt})))}s.directDiffuse.addAssign(i.mul(js({diffuseColor:_e.rgb}))),s.directSpecular.addAssign(i.mul(ci({lightDirection:e,f0:Tt,f90:1,roughness:Ns,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(js({diffuseColor:_e})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(Zt,gm({normal:Ne,viewDir:xe,roughness:un}))),this.clearcoat===!0){const l=Jt.dot(xe).clamp(),u=am({dotNV:l,specularColor:zo,specularF90:Do,roughness:ks});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(u))}const n=N().temp("singleScattering"),i=N().temp("multiScattering"),r=t.mul(1/Math.PI);this.computeMultiscattering(n,i);const a=n.add(i),c=_e.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(n)),s.indirectSpecular.addAssign(i.mul(r)),s.indirectDiffuse.addAssign(c.mul(r))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const n=Ne.dot(xe).clamp().add(e),i=Ns.mul(-16).oneMinus().negate().exp2(),r=e.sub(n.pow(i).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(r)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=Jt.dot(xe).clamp(),n=ws({dotVH:s,f0:zo,f90:Do}),i=t.mul(Go.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Go));t.assign(i)}if(this.sheen===!0){const s=Zt.r.max(Zt.g).max(Zt.b).mul(.157).oneMinus(),n=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(n)}}}const Nm=new dl;class Ea extends ot{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Nm),this.setValues(e)}setupLightingModel(){return new En}setupVariants(){const e=this.metalnessNode?d(this.metalnessNode):Sd;ou.assign(e);let t=this.roughnessNode?d(this.roughnessNode):Rd;t=nm({roughness:t}),Ns.assign(t);const s=Qe(N(.04),_e.rgb,e);Tt.assign(s),_e.assign(I(_e.rgb.mul(e.oneMinus()),_e.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}Be("MeshStandardNodeMaterial",Ea);const ym=new hl;class wa extends Ea{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(ym),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}setupLightingModel(){return new En(this.useClearcoat,this.useSheen,this.useIridescence)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?d(this.clearcoatNode):Vd,s=this.clearcoatRoughnessNode?d(this.clearcoatRoughnessNode):Ad;Go.assign(t),ks.assign(s)}if(this.useSheen){const t=this.sheenNode?N(this.sheenNode):Id,s=this.sheenRoughnessNode?d(this.sheenRoughnessNode):Od;Zt.assign(t),un.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?d(this.iridescenceNode):bd,s=this.iridescenceIORNode?d(this.iridescenceIORNode):zd,n=this.iridescenceThicknessNode?d(this.iridescenceThicknessNode):Dd;dn.assign(t),Fi.assign(s),Hi.assign(n)}}setupNormal(e){super.setupNormal(e);const t=this.clearcoatNormalNode?N(this.clearcoatNormalNode):Ld;Jt.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}Be("MeshPhysicalNodeMaterial",wa);class Tm extends En{constructor(e,t,s,n){super(e,t,s),this.useSSS=n}direct({lightDirection:e,lightColor:t,reflectedLight:s},n,i){if(this.useSSS===!0){const r=i.material,{thicknessColorNode:a,thicknessDistortionNode:c,thicknessAmbientNode:l,thicknessAttenuationNode:u,thicknessPowerNode:p,thicknessScaleNode:g}=r,v=e.add(Ne.mul(c)).normalize(),E=d(xe.dot(v.negate()).saturate().pow(p).mul(g)),R=N(E.add(l).mul(a));s.directDiffuse.addAssign(R.mul(u.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:s},n,i)}}class xm extends wa{constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=d(.1),this.thicknessAmbientNode=d(0),this.thicknessAttenuationNode=d(.1),this.thicknessPowerNode=d(2),this.thicknessScaleNode=d(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new Tm(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}Be("MeshSSSNodeMaterial",xm);const vm=new Ni;class Em extends ot{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(vm),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}Be("PointsNodeMaterial",Em);const wm=new pl;class Mm extends ot{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(wm),this.setValues(e)}setupPosition({object:e,context:t}){const{positionNode:s,rotationNode:n,scaleNode:i}=this,r=ze;let a=Pt.mul(N(s||0)),c=H(Bs[0].xyz.length(),Bs[1].xyz.length());i!==null&&(c=c.mul(i));let l=r.xy;e.center&&e.center.isVector2===!0&&(l=l.sub(le(e.center).sub(.5))),l=l.mul(c);const u=d(n||Cd),p=l.rotate(u);a=I(a.xy.add(p),a.zw);const g=vt.mul(a);return t.vertex=r,g}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}Be("SpriteNodeMaterial",Mm);const os=T(([o,e,t])=>{const s=d(t).toVar(),n=d(e).toVar(),i=Ht(o).toVar();return je(i,n,s)}),Ms=T(([o,e])=>{const t=Ht(e).toVar(),s=d(o).toVar();return je(t,s.negate(),s)}),fe=T(([o])=>{const e=d(o).toVar();return h(as(e))}),de=T(([o,e])=>{const t=d(o).toVar();return e.assign(fe(t)),t.sub(d(e))}),Ma=T(([o,e,t,s,n,i])=>{const r=d(i).toVar(),a=d(n).toVar(),c=d(s).toVar(),l=d(t).toVar(),u=d(e).toVar(),p=d(o).toVar(),g=d(ye(1,a)).toVar();return ye(1,r).mul(p.mul(g).add(u.mul(a))).add(r.mul(l.mul(g).add(c.mul(a))))}),Ra=T(([o,e,t,s,n,i])=>{const r=d(i).toVar(),a=d(n).toVar(),c=N(s).toVar(),l=N(t).toVar(),u=N(e).toVar(),p=N(o).toVar(),g=d(ye(1,a)).toVar();return ye(1,r).mul(p.mul(g).add(u.mul(a))).add(r.mul(l.mul(g).add(c.mul(a))))}),Sa=nt([Ma,Ra]),_a=T(([o,e,t,s,n,i,r,a,c,l,u])=>{const p=d(u).toVar(),g=d(l).toVar(),v=d(c).toVar(),E=d(a).toVar(),R=d(r).toVar(),B=d(i).toVar(),k=d(n).toVar(),A=d(s).toVar(),S=d(t).toVar(),ne=d(e).toVar(),ge=d(o).toVar(),Y=d(ye(1,v)).toVar(),C=d(ye(1,g)).toVar();return d(ye(1,p)).toVar().mul(C.mul(ge.mul(Y).add(ne.mul(v))).add(g.mul(S.mul(Y).add(A.mul(v))))).add(p.mul(C.mul(k.mul(Y).add(B.mul(v))).add(g.mul(R.mul(Y).add(E.mul(v))))))}),Va=T(([o,e,t,s,n,i,r,a,c,l,u])=>{const p=d(u).toVar(),g=d(l).toVar(),v=d(c).toVar(),E=N(a).toVar(),R=N(r).toVar(),B=N(i).toVar(),k=N(n).toVar(),A=N(s).toVar(),S=N(t).toVar(),ne=N(e).toVar(),ge=N(o).toVar(),Y=d(ye(1,v)).toVar(),C=d(ye(1,g)).toVar();return d(ye(1,p)).toVar().mul(C.mul(ge.mul(Y).add(ne.mul(v))).add(g.mul(S.mul(Y).add(A.mul(v))))).add(p.mul(C.mul(k.mul(Y).add(B.mul(v))).add(g.mul(R.mul(Y).add(E.mul(v))))))}),Aa=nt([_a,Va]),La=T(([o,e,t])=>{const s=d(t).toVar(),n=d(e).toVar(),i=_(o).toVar(),r=_(i.bitAnd(_(7))).toVar(),a=d(os(r.lessThan(_(4)),n,s)).toVar(),c=d(J(2,os(r.lessThan(_(4)),s,n))).toVar();return Ms(a,Ht(r.bitAnd(_(1)))).add(Ms(c,Ht(r.bitAnd(_(2)))))}),Ca=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=d(e).toVar(),a=_(o).toVar(),c=_(a.bitAnd(_(15))).toVar(),l=d(os(c.lessThan(_(8)),r,i)).toVar(),u=d(os(c.lessThan(_(4)),i,os(c.equal(_(12)).or(c.equal(_(14))),r,n))).toVar();return Ms(l,Ht(c.bitAnd(_(1)))).add(Ms(u,Ht(c.bitAnd(_(2)))))}),Se=nt([La,Ca]),Ia=T(([o,e,t])=>{const s=d(t).toVar(),n=d(e).toVar(),i=Rs(o).toVar();return N(Se(i.x,n,s),Se(i.y,n,s),Se(i.z,n,s))}),Oa=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=d(e).toVar(),a=Rs(o).toVar();return N(Se(a.x,r,i,n),Se(a.y,r,i,n),Se(a.z,r,i,n))}),et=nt([Ia,Oa]),ba=T(([o])=>{const e=d(o).toVar();return J(.6616,e)}),za=T(([o])=>{const e=d(o).toVar();return J(.982,e)}),Da=T(([o])=>{const e=N(o).toVar();return J(.6616,e)}),Fa=nt([ba,Da]),Ha=T(([o])=>{const e=N(o).toVar();return J(.982,e)}),Pa=nt([za,Ha]),He=T(([o,e])=>{const t=h(e).toVar(),s=_(o).toVar();return s.shiftLeft(t).bitOr(s.shiftRight(h(32).sub(t)))}),ka=T(([o,e,t])=>{o.subAssign(t),o.bitXorAssign(He(t,h(4))),t.addAssign(e),e.subAssign(o),e.bitXorAssign(He(o,h(6))),o.addAssign(t),t.subAssign(e),t.bitXorAssign(He(e,h(8))),e.addAssign(o),o.subAssign(t),o.bitXorAssign(He(t,h(16))),t.addAssign(e),e.subAssign(o),e.bitXorAssign(He(o,h(19))),o.addAssign(t),t.subAssign(e),t.bitXorAssign(He(e,h(4))),e.addAssign(o)}),hs=T(([o,e,t])=>{const s=_(t).toVar(),n=_(e).toVar(),i=_(o).toVar();return s.bitXorAssign(n),s.subAssign(He(n,h(14))),i.bitXorAssign(s),i.subAssign(He(s,h(11))),n.bitXorAssign(i),n.subAssign(He(i,h(25))),s.bitXorAssign(n),s.subAssign(He(n,h(16))),i.bitXorAssign(s),i.subAssign(He(s,h(4))),n.bitXorAssign(i),n.subAssign(He(i,h(14))),s.bitXorAssign(n),s.subAssign(He(n,h(24))),s}),Ce=T(([o])=>{const e=_(o).toVar();return d(e).div(d(_(h(4294967295))))}),lt=T(([o])=>{const e=d(o).toVar();return e.mul(e.mul(e.mul(e.mul(e.mul(6).sub(15)).add(10))))}),Ga=T(([o])=>{const e=h(o).toVar(),t=_(_(1)).toVar(),s=_(_(h(3735928559)).add(t.shiftLeft(_(2)).add(_(13)))).toVar();return hs(s.add(_(e)),s,s)}),Ba=T(([o,e])=>{const t=h(e).toVar(),s=h(o).toVar(),n=_(_(2)).toVar(),i=_().toVar(),r=_().toVar(),a=_().toVar();return i.assign(r.assign(a.assign(_(h(3735928559)).add(n.shiftLeft(_(2)).add(_(13)))))),i.addAssign(_(s)),r.addAssign(_(t)),hs(i,r,a)}),Ua=T(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=h(o).toVar(),r=_(_(3)).toVar(),a=_().toVar(),c=_().toVar(),l=_().toVar();return a.assign(c.assign(l.assign(_(h(3735928559)).add(r.shiftLeft(_(2)).add(_(13)))))),a.addAssign(_(i)),c.addAssign(_(n)),l.addAssign(_(s)),hs(a,c,l)}),Wa=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=h(o).toVar(),c=_(_(4)).toVar(),l=_().toVar(),u=_().toVar(),p=_().toVar();return l.assign(u.assign(p.assign(_(h(3735928559)).add(c.shiftLeft(_(2)).add(_(13)))))),l.addAssign(_(a)),u.addAssign(_(r)),p.addAssign(_(i)),ka(l,u,p),l.addAssign(_(n)),hs(l,u,p)}),qa=T(([o,e,t,s,n])=>{const i=h(n).toVar(),r=h(s).toVar(),a=h(t).toVar(),c=h(e).toVar(),l=h(o).toVar(),u=_(_(5)).toVar(),p=_().toVar(),g=_().toVar(),v=_().toVar();return p.assign(g.assign(v.assign(_(h(3735928559)).add(u.shiftLeft(_(2)).add(_(13)))))),p.addAssign(_(l)),g.addAssign(_(c)),v.addAssign(_(a)),ka(p,g,v),p.addAssign(_(r)),g.addAssign(_(i)),hs(p,g,v)}),te=nt([Ga,Ba,Ua,Wa,qa]),$a=T(([o,e])=>{const t=h(e).toVar(),s=h(o).toVar(),n=_(te(s,t)).toVar(),i=Rs().toVar();return i.x.assign(n.bitAnd(h(255))),i.y.assign(n.shiftRight(h(8)).bitAnd(h(255))),i.z.assign(n.shiftRight(h(16)).bitAnd(h(255))),i}),Xa=T(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=h(o).toVar(),r=_(te(i,n,s)).toVar(),a=Rs().toVar();return a.x.assign(r.bitAnd(h(255))),a.y.assign(r.shiftRight(h(8)).bitAnd(h(255))),a.z.assign(r.shiftRight(h(16)).bitAnd(h(255))),a}),tt=nt([$a,Xa]),ja=T(([o])=>{const e=H(o).toVar(),t=h().toVar(),s=h().toVar(),n=d(de(e.x,t)).toVar(),i=d(de(e.y,s)).toVar(),r=d(lt(n)).toVar(),a=d(lt(i)).toVar(),c=d(Sa(Se(te(t,s),n,i),Se(te(t.add(h(1)),s),n.sub(1),i),Se(te(t,s.add(h(1))),n,i.sub(1)),Se(te(t.add(h(1)),s.add(h(1))),n.sub(1),i.sub(1)),r,a)).toVar();return Fa(c)}),Ya=T(([o])=>{const e=N(o).toVar(),t=h().toVar(),s=h().toVar(),n=h().toVar(),i=d(de(e.x,t)).toVar(),r=d(de(e.y,s)).toVar(),a=d(de(e.z,n)).toVar(),c=d(lt(i)).toVar(),l=d(lt(r)).toVar(),u=d(lt(a)).toVar(),p=d(Aa(Se(te(t,s,n),i,r,a),Se(te(t.add(h(1)),s,n),i.sub(1),r,a),Se(te(t,s.add(h(1)),n),i,r.sub(1),a),Se(te(t.add(h(1)),s.add(h(1)),n),i.sub(1),r.sub(1),a),Se(te(t,s,n.add(h(1))),i,r,a.sub(1)),Se(te(t.add(h(1)),s,n.add(h(1))),i.sub(1),r,a.sub(1)),Se(te(t,s.add(h(1)),n.add(h(1))),i,r.sub(1),a.sub(1)),Se(te(t.add(h(1)),s.add(h(1)),n.add(h(1))),i.sub(1),r.sub(1),a.sub(1)),c,l,u)).toVar();return Pa(p)}),Rm=nt([ja,Ya]),Za=T(([o])=>{const e=H(o).toVar(),t=h().toVar(),s=h().toVar(),n=d(de(e.x,t)).toVar(),i=d(de(e.y,s)).toVar(),r=d(lt(n)).toVar(),a=d(lt(i)).toVar(),c=N(Sa(et(tt(t,s),n,i),et(tt(t.add(h(1)),s),n.sub(1),i),et(tt(t,s.add(h(1))),n,i.sub(1)),et(tt(t.add(h(1)),s.add(h(1))),n.sub(1),i.sub(1)),r,a)).toVar();return Fa(c)}),Ja=T(([o])=>{const e=N(o).toVar(),t=h().toVar(),s=h().toVar(),n=h().toVar(),i=d(de(e.x,t)).toVar(),r=d(de(e.y,s)).toVar(),a=d(de(e.z,n)).toVar(),c=d(lt(i)).toVar(),l=d(lt(r)).toVar(),u=d(lt(a)).toVar(),p=N(Aa(et(tt(t,s,n),i,r,a),et(tt(t.add(h(1)),s,n),i.sub(1),r,a),et(tt(t,s.add(h(1)),n),i,r.sub(1),a),et(tt(t.add(h(1)),s.add(h(1)),n),i.sub(1),r.sub(1),a),et(tt(t,s,n.add(h(1))),i,r,a.sub(1)),et(tt(t.add(h(1)),s,n.add(h(1))),i.sub(1),r,a.sub(1)),et(tt(t,s.add(h(1)),n.add(h(1))),i,r.sub(1),a.sub(1)),et(tt(t.add(h(1)),s.add(h(1)),n.add(h(1))),i.sub(1),r.sub(1),a.sub(1)),c,l,u)).toVar();return Pa(p)}),Sm=nt([Za,Ja]),_m=T(([o])=>{const e=d(o).toVar(),t=h(fe(e)).toVar();return Ce(te(t))}),Vm=T(([o])=>{const e=H(o).toVar(),t=h(fe(e.x)).toVar(),s=h(fe(e.y)).toVar();return Ce(te(t,s))}),Am=T(([o])=>{const e=N(o).toVar(),t=h(fe(e.x)).toVar(),s=h(fe(e.y)).toVar(),n=h(fe(e.z)).toVar();return Ce(te(t,s,n))}),Lm=T(([o])=>{const e=I(o).toVar(),t=h(fe(e.x)).toVar(),s=h(fe(e.y)).toVar(),n=h(fe(e.z)).toVar(),i=h(fe(e.w)).toVar();return Ce(te(t,s,n,i))}),Ka=T(([o])=>{const e=d(o).toVar(),t=h(fe(e)).toVar();return N(Ce(te(t,h(0))),Ce(te(t,h(1))),Ce(te(t,h(2))))}),Qa=T(([o])=>{const e=H(o).toVar(),t=h(fe(e.x)).toVar(),s=h(fe(e.y)).toVar();return N(Ce(te(t,s,h(0))),Ce(te(t,s,h(1))),Ce(te(t,s,h(2))))}),ec=T(([o])=>{const e=N(o).toVar(),t=h(fe(e.x)).toVar(),s=h(fe(e.y)).toVar(),n=h(fe(e.z)).toVar();return N(Ce(te(t,s,n,h(0))),Ce(te(t,s,n,h(1))),Ce(te(t,s,n,h(2))))}),tc=T(([o])=>{const e=I(o).toVar(),t=h(fe(e.x)).toVar(),s=h(fe(e.y)).toVar(),n=h(fe(e.z)).toVar(),i=h(fe(e.w)).toVar();return N(Ce(te(t,s,n,i,h(0))),Ce(te(t,s,n,i,h(1))),Ce(te(t,s,n,i,h(2))))}),sc=nt([Ka,Qa,ec,tc]),Ys=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=h(e).toVar(),a=N(o).toVar(),c=d(0).toVar(),l=d(1).toVar();return ue({start:h(0),end:r},({i:u})=>{c.addAssign(l.mul(Rm(a))),l.mulAssign(n),a.mulAssign(i)}),c}),oc=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=h(e).toVar(),a=N(o).toVar(),c=N(0).toVar(),l=d(1).toVar();return ue({start:h(0),end:r},({i:u})=>{c.addAssign(l.mul(Sm(a))),l.mulAssign(n),a.mulAssign(i)}),c}),Cm=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=h(e).toVar(),a=N(o).toVar();return H(Ys(a,r,i,n),Ys(a.add(N(h(19),h(193),h(17))),r,i,n))}),Im=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=h(e).toVar(),a=N(o).toVar(),c=N(oc(a,r,i,n)).toVar(),l=d(Ys(a.add(N(h(19),h(193),h(17))),r,i,n)).toVar();return I(c,l)}),nc=T(([o,e,t,s,n,i,r])=>{const a=h(r).toVar(),c=d(i).toVar(),l=h(n).toVar(),u=h(s).toVar(),p=h(t).toVar(),g=h(e).toVar(),v=H(o).toVar(),E=N(sc(H(g.add(u),p.add(l)))).toVar(),R=H(E.x,E.y).toVar();R.subAssign(.5),R.mulAssign(c),R.addAssign(.5);const B=H(H(d(g),d(p)).add(R)).toVar(),k=H(B.sub(v)).toVar();return Z(a.equal(h(2)),()=>Te(k.x).add(Te(k.y))),Z(a.equal(h(3)),()=>Ke(Te(k.x),Te(k.y))),cs(k,k)}),ic=T(([o,e,t,s,n,i,r,a,c])=>{const l=h(c).toVar(),u=d(a).toVar(),p=h(r).toVar(),g=h(i).toVar(),v=h(n).toVar(),E=h(s).toVar(),R=h(t).toVar(),B=h(e).toVar(),k=N(o).toVar(),A=N(sc(N(B.add(v),R.add(g),E.add(p)))).toVar();A.subAssign(.5),A.mulAssign(u),A.addAssign(.5);const S=N(N(d(B),d(R),d(E)).add(A)).toVar(),ne=N(S.sub(k)).toVar();return Z(l.equal(h(2)),()=>Te(ne.x).add(Te(ne.y).add(Te(ne.z)))),Z(l.equal(h(3)),()=>Ke(Ke(Te(ne.x),Te(ne.y)),Te(ne.z))),cs(ne,ne)}),ps=nt([nc,ic]),Om=T(([o,e,t])=>{const s=h(t).toVar(),n=d(e).toVar(),i=H(o).toVar(),r=h().toVar(),a=h().toVar(),c=H(de(i.x,r),de(i.y,a)).toVar(),l=d(1e6).toVar();return ue({start:-1,end:h(1),name:"x",condition:"<="},({x:u})=>{ue({start:-1,end:h(1),name:"y",condition:"<="},({y:p})=>{const g=d(ps(c,u,p,r,a,n,s)).toVar();l.assign(Ts(l,g))})}),Z(s.equal(h(0)),()=>{l.assign(Bt(l))}),l}),bm=T(([o,e,t])=>{const s=h(t).toVar(),n=d(e).toVar(),i=H(o).toVar(),r=h().toVar(),a=h().toVar(),c=H(de(i.x,r),de(i.y,a)).toVar(),l=H(1e6,1e6).toVar();return ue({start:-1,end:h(1),name:"x",condition:"<="},({x:u})=>{ue({start:-1,end:h(1),name:"y",condition:"<="},({y:p})=>{const g=d(ps(c,u,p,r,a,n,s)).toVar();Z(g.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(g)}).elseif(g.lessThan(l.y),()=>{l.y.assign(g)})})}),Z(s.equal(h(0)),()=>{l.assign(Bt(l))}),l}),zm=T(([o,e,t])=>{const s=h(t).toVar(),n=d(e).toVar(),i=H(o).toVar(),r=h().toVar(),a=h().toVar(),c=H(de(i.x,r),de(i.y,a)).toVar(),l=N(1e6,1e6,1e6).toVar();return ue({start:-1,end:h(1),name:"x",condition:"<="},({x:u})=>{ue({start:-1,end:h(1),name:"y",condition:"<="},({y:p})=>{const g=d(ps(c,u,p,r,a,n,s)).toVar();Z(g.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(g)}).elseif(g.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(g)}).elseif(g.lessThan(l.z),()=>{l.z.assign(g)})})}),Z(s.equal(h(0)),()=>{l.assign(Bt(l))}),l}),Dm=T(([o,e,t])=>{const s=h(t).toVar(),n=d(e).toVar(),i=N(o).toVar(),r=h().toVar(),a=h().toVar(),c=h().toVar(),l=N(de(i.x,r),de(i.y,a),de(i.z,c)).toVar(),u=d(1e6).toVar();return ue({start:-1,end:h(1),name:"x",condition:"<="},({x:p})=>{ue({start:-1,end:h(1),name:"y",condition:"<="},({y:g})=>{ue({start:-1,end:h(1),name:"z",condition:"<="},({z:v})=>{const E=d(ps(l,p,g,v,r,a,c,n,s)).toVar();u.assign(Ts(u,E))})})}),Z(s.equal(h(0)),()=>{u.assign(Bt(u))}),u}),Fm=T(([o,e,t])=>{const s=h(t).toVar(),n=d(e).toVar(),i=N(o).toVar(),r=h().toVar(),a=h().toVar(),c=h().toVar(),l=N(de(i.x,r),de(i.y,a),de(i.z,c)).toVar(),u=H(1e6,1e6).toVar();return ue({start:-1,end:h(1),name:"x",condition:"<="},({x:p})=>{ue({start:-1,end:h(1),name:"y",condition:"<="},({y:g})=>{ue({start:-1,end:h(1),name:"z",condition:"<="},({z:v})=>{const E=d(ps(l,p,g,v,r,a,c,n,s)).toVar();Z(E.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(E)}).elseif(E.lessThan(u.y),()=>{u.y.assign(E)})})})}),Z(s.equal(h(0)),()=>{u.assign(Bt(u))}),u}),Hm=T(([o,e,t])=>{const s=h(t).toVar(),n=d(e).toVar(),i=N(o).toVar(),r=h().toVar(),a=h().toVar(),c=h().toVar(),l=N(de(i.x,r),de(i.y,a),de(i.z,c)).toVar(),u=N(1e6,1e6,1e6).toVar();return ue({start:-1,end:h(1),name:"x",condition:"<="},({x:p})=>{ue({start:-1,end:h(1),name:"y",condition:"<="},({y:g})=>{ue({start:-1,end:h(1),name:"z",condition:"<="},({z:v})=>{const E=d(ps(l,p,g,v,r,a,c,n,s)).toVar();Z(E.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(E)}).elseif(E.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(E)}).elseif(E.lessThan(u.z),()=>{u.z.assign(E)})})})}),Z(s.equal(h(0)),()=>{u.assign(Bt(u))}),u});os.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});Ms.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});fe.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});Ma.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});Ra.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});_a.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});Va.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});La.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});Ca.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});Ia.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});Oa.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});ba.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});za.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});Da.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});Ha.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});He.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});hs.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});Ce.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});lt.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});Ga.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});Ba.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});Ua.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});Wa.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});qa.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});$a.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});Xa.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});ja.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});Ya.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});Za.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});Ja.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});_m.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});Vm.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});Am.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});Lm.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});Ka.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});Qa.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});ec.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});tc.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});Ys.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});oc.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Cm.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Im.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});nc.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});ic.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Om.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});bm.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});zm.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Dm.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Fm.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Hm.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const Pm=T(([o])=>{const e=N(o).toVar(),t=d(e.x).toVar(),s=d(e.y).toVar(),n=d(e.z).toVar();Z(s.lessThan(1e-4),()=>N(n,n,n)).else(()=>{t.assign(J(6,t.sub(as(t))));const i=h($i(t)).toVar(),r=d(t.sub(d(i))).toVar(),a=d(n.mul(ye(1,s))).toVar(),c=d(n.mul(ye(1,s.mul(r)))).toVar(),l=d(n.mul(ye(1,s.mul(ye(1,r))))).toVar();return Z(i.equal(h(0)),()=>N(n,l,a)).elseif(i.equal(h(1)),()=>N(c,n,a)).elseif(i.equal(h(2)),()=>N(a,n,l)).elseif(i.equal(h(3)),()=>N(a,c,n)).elseif(i.equal(h(4)),()=>N(l,a,n)),N(n,a,c)})}),km=T(([o])=>{const e=N(o).toVar(),t=d(e.x).toVar(),s=d(e.y).toVar(),n=d(e.z).toVar(),i=d(Ts(t,Ts(s,n))).toVar(),r=d(Ke(t,Ke(s,n))).toVar(),a=d(r.sub(i)).toVar(),c=d().toVar(),l=d().toVar(),u=d().toVar();return u.assign(r),Z(r.greaterThan(0),()=>{l.assign(a.div(r))}).else(()=>{l.assign(0)}),Z(l.lessThanEqual(0),()=>{c.assign(0)}).else(()=>{Z(t.greaterThanEqual(r),()=>{c.assign(s.sub(n).div(a))}).elseif(s.greaterThanEqual(r),()=>{c.assign(Ze(2,n.sub(t).div(a)))}).else(()=>{c.assign(Ze(4,t.sub(s).div(a)))}),c.mulAssign(1/6),Z(c.lessThan(0),()=>{c.addAssign(1)})}),N(c,l,u)});Pm.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});km.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const Gm=T(([o])=>{const e=N(o).toVar(),t=_i(Bi(e,N(.04045))).toVar(),s=N(e.div(12.92)).toVar(),n=N(ft(Ke(e.add(N(.055)),N(0)).div(1.055),N(2.4))).toVar();return Qe(s,n,t)});Gm.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});let b,be,Fe,Kt,bt,zs,Fs,rc,ac,tn,cc=[];const Bm=3752e3;qm();Um();function Um(){const o=new THREE.LoadingManager;o.onLoad=function(){Wm()},new THREE.GLTFLoader(o).load("https://cdn.glitch.global/3bbd10eb-4c8c-4be9-b625-ecd05c7361c5/rubber_duck.glb?v=1664492164732",function(A){console.log(A),Fs=A.scene,Fs.position.set(20,5,-4),b.add(Fs)}),new THREE.GLTFLoader(o).load("tables_and_chairs/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-190,-8,280),S.scale.set(8,8,8),b.add(S)}),new THREE.GLTFLoader(o).load("minecraft_bee/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-175,15,320),S.scale.set(50,50,50),S.rotation.y=Math.PI/2+1,b.add(S)}),new THREE.GLTFLoader(o).load("minecraft_bee/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-185,10,302),S.scale.set(50,50,50),S.rotation.y=Math.PI/2-1,b.add(S)}),new THREE.GLTFLoader(o).load("minecraft_grass_block/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-185,1,315),S.scale.set(3,3,3),b.add(S)}),new THREE.GLTFLoader(o).load("minecraft_grass_block/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-185,1,309),S.scale.set(3,3,3),b.add(S)}),new THREE.GLTFLoader(o).load("minecraft_grass_block/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-179,1,315),S.scale.set(3,3,3),b.add(S)}),new THREE.GLTFLoader(o).load("minecraft_grass_block/scene.gltf",function(A){console.log(A);const S=A.scene;S.position.set(-185,7,315),S.scale.set(3,3,3),b.add(S)}),new THREE.ObjectLoader(o).load("data/bench.json",function(A){A.position.set(20,.5,-5),A.scale.set(5,5,5),b.add(A)})}function Wm(){$m(),Xm(),lc()}function qm(){new THREE.Color(1,1,1),b=new THREE.Scene,be=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e3),be.position.z=300,be.position.y=10,be.position.x=30,be.lookAt(0,10,300),Fe=new THREE.WebGLRenderer,Fe.setSize(window.innerWidth,window.innerHeight),Fe.outputEncoding=THREE.sRGBEncoding,Fe.shadowMap.enabled=!0,Fe.shadowMap.type=THREE.PCFSoftShadowMap,Fe.toneMapping=THREE.ACESFilmicToneMapping,Fe.toneMappingExposure=.5,document.body.appendChild(Fe.domElement),Kt=new ml(be,Fe.domElement),Kt.movementSpeed=20,Kt.lookSpeed=.02,Kt.lookVertical=!0,window.addEventListener("resize",Ym,!1)}function $m(){const o=new THREE.AmbientLight(Bm);b.add(o);const e=new THREE.HemisphereLight(16777147,526368,1);b.add(e);const t=new THREE.DirectionalLight(16777215,.5);t.position.set(50,50,-50),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=1,t.shadow.camera.far=500,t.shadow.camera.left=-100,t.shadow.camera.right=100,t.shadow.camera.top=100,t.shadow.camera.bottom=-100,b.add(t),bt=new THREE.Sky,bt.scale.setScalar(45e4),b.add(bt),console.log(bt.material.uniforms),bt.material.uniforms.mieCoefficient.value=.005,bt.material.uniforms.mieDirectionalG.value=.7,zs=new THREE.Vector3;let s=2,n=180;const i=THREE.MathUtils.degToRad(90-s),r=THREE.MathUtils.degToRad(n);zs.setFromSphericalCoords(1,i,r),bt.material.uniforms.sunPosition.value.copy(zs),t.position.copy(zs)}function Xm(){const o="https://cdn.glitch.global/28e73932-4e53-4402-8dd9-973314542393/256x256_Dissolve_Noise_Texture.png?v=1663195178908",t=new THREE.TextureLoader().load("https://cdn.glitch.global/28e73932-4e53-4402-8dd9-973314542393/_grass_4__grass_textures_seamless_turf_lawn_green_ground_field_texture_5.jpg?v=1663195183829");t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(100,100);const s=new THREE.PlaneGeometry(1500,1500),n=new THREE.MeshStandardMaterial({color:10025880,side:THREE.DoubleSide,map:t}),i=new THREE.Mesh(s,n);i.rotation.x=Math.PI/2,i.receiveShadow=!0,b.add(i);const r=new THREE.TextureLoader().load(o);r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping,r.repeat.set(1,4);const a=[];ge(250,100),ge(150,200),Y(),v(),E(),p(300,-75,30,200),g(273,-173,7,50),l(),c();function c(){rc=C(-30,0,210),ac=C(-60,0,260);function C(Q,F,No){const wc=new THREE.CylinderGeometry(3,3,30,12),Mc=new THREE.MeshStandardMaterial({color:9127187,map:r}),Ls=new THREE.Mesh(wc,Mc);Ls.position.set(Q,F+30/2,No),Ls.castShadow=!0,Ls.receiveShadow=!0,b.add(Ls);const Rc=80+60/4,Sc=new THREE.SphereGeometry(10,8,8),_c=new THREE.MeshStandardMaterial({color:16758725,map:r});for(let jt=0;jt<Rc;jt++){const Cs=new THREE.Mesh(Sc,_c),_n=Math.random()*Math.PI*2,Ac=F+30+Math.random()*60*.2,Vn=10;Cs.position.set(Q+Math.cos(_n)*Vn,Ac,No+Math.sin(_n)*Vn),Cs.castShadow=!0,Cs.receiveShadow=!0,b.add(Cs)}const Mn=500,Rn=new THREE.BufferGeometry,Sn=new Float32Array(Mn*3);for(let jt=0;jt<Mn*3;jt++)Sn[jt]=Math.random()*200-100;Rn.setAttribute("position",new THREE.BufferAttribute(Sn,4));const Vc=new THREE.PointsMaterial({color:16758725,size:.5,transparent:!0,opacity:.6}),yo=new THREE.Points(Rn,Vc);return yo.position.set(Q,F,No),b.add(yo),yo}const L=70,P=new THREE.CylinderGeometry(2,5,L,12),D=new THREE.MeshStandardMaterial({color:4860687,map:r}),O=new THREE.Mesh(P,D);O.castShadow=!0,O.receiveShadow=!0,O.position.set(-70,0+L/2,340),O.castShadow=!0,O.receiveShadow=!0,b.add(O);const ee=new THREE.IcosahedronGeometry(15,1),ie=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(ee,ie);F.position.set(-70+Math.random()*10-5,0+L-Q*5,340+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}const j=50,X=new THREE.CylinderGeometry(2,5,j,12),U=new THREE.MeshStandardMaterial({color:4860687,map:r}),W=new THREE.Mesh(X,U);W.castShadow=!0,W.receiveShadow=!0,W.position.set(-120,0+j/2,328),W.castShadow=!0,W.receiveShadow=!0,b.add(W);const q=new THREE.IcosahedronGeometry(15,1),K=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(q,K);F.position.set(-120+Math.random()*10-5,0+j-Q*5,328+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}const pe=30,Ue=new THREE.CylinderGeometry(2,3,pe,8),Ct=new THREE.MeshStandardMaterial({color:4860687,map:r}),We=new THREE.Mesh(Ue,Ct);We.castShadow=!0,We.receiveShadow=!0,We.position.set(-120,0+pe/2,270),We.castShadow=!0,We.receiveShadow=!0,b.add(We);const it=new THREE.IcosahedronGeometry(15,1),mo=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(it,mo);F.position.set(-120+Math.random()*10-5,0+j-15-Q*2,270+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}const Vs=30,Wt=new THREE.CylinderGeometry(2,3,Vs,8),As=new THREE.MeshStandardMaterial({color:4860687,map:r}),qe=new THREE.Mesh(Wt,As);qe.castShadow=!0,qe.receiveShadow=!0,qe.position.set(-145,0+Vs/2,245),qe.castShadow=!0,qe.receiveShadow=!0,b.add(qe);const Mt=new THREE.IcosahedronGeometry(15,1),uc=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(Mt,uc);F.position.set(-145+Math.random()*10-5,0+j-15-Q*2,245+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}const wn=50,dc=new THREE.CylinderGeometry(2,5,wn,12),hc=new THREE.MeshStandardMaterial({color:4860687,map:r}),qt=new THREE.Mesh(dc,hc);qt.castShadow=!0,qt.receiveShadow=!0,qt.position.set(-220,0+wn/2,300),qt.castShadow=!0,qt.receiveShadow=!0,b.add(qt);const pc=new THREE.IcosahedronGeometry(15,1),mc=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(pc,mc);F.position.set(-220+Math.random()*10-5,2+j-Q*5,300+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}const fo=70,fc=new THREE.CylinderGeometry(2,5,fo,12),gc=new THREE.MeshStandardMaterial({color:4860687,map:r}),$t=new THREE.Mesh(fc,gc);$t.castShadow=!0,$t.receiveShadow=!0,$t.position.set(-180,0+fo/2,340),$t.castShadow=!0,$t.receiveShadow=!0,b.add($t);const Nc=new THREE.IcosahedronGeometry(15,1),yc=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(Nc,yc);F.position.set(-180+Math.random()*10-5,0+fo-Q*5,340+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}const go=80,Tc=new THREE.CylinderGeometry(2,6,go,12),xc=new THREE.MeshStandardMaterial({color:4860687,map:r}),Xt=new THREE.Mesh(Tc,xc);Xt.castShadow=!0,Xt.receiveShadow=!0,Xt.position.set(-250,0+go/2,370),Xt.castShadow=!0,Xt.receiveShadow=!0,b.add(Xt);const vc=new THREE.IcosahedronGeometry(30,1),Ec=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let Q=0;Q<5;Q++){let F=new THREE.Mesh(vc,Ec);F.position.set(-250+Math.random()*10-5,0+go-Q*5,370+Math.random()*10-5),F.rotation.x=Math.random()*Math.PI,F.rotation.z=Math.random()*Math.PI,F.castShadow=!0,F.receiveShadow=!0,b.add(F)}}function l(){const O=new THREE.Group,ee=new THREE.TextureLoader().load("data/madeira.jpeg"),ie=new THREE.TextureLoader().load("data/cortica.png"),j=new THREE.MeshBasicMaterial({map:ee}),X=new THREE.BoxGeometry(25,1,1),U=new THREE.Mesh(X,j);U.position.y=12+15/2-1/2,U.position.z=280-1/2,U.position.x=-10,O.add(U);const W=new THREE.BoxGeometry(25,1,1),q=new THREE.Mesh(W,j);q.position.y=12-15/2+1/2,q.position.z=280-1/2,q.position.x=-10,O.add(q);const K=new THREE.BoxGeometry(1,15-2*1,1),pe=new THREE.Mesh(K,j);pe.position.x=-10-25/2+1/2,pe.position.z=280-1/2,pe.position.y=12,O.add(pe);const Ue=new THREE.Mesh(K,j);Ue.position.x=-10+25/2-1/2,Ue.position.z=280-1/2,Ue.position.y=12,O.add(Ue);const Ct=new THREE.BoxGeometry(25-2*1,15-2*1,.1),We=new THREE.MeshBasicMaterial({color:12817515,map:ie}),it=new THREE.Mesh(Ct,We);it.position.z=279+.1,it.position.y=12,it.position.x=-10,O.add(it);const mo=new THREE.BoxGeometry(25-2*1,15-2*1,.1),Vs=new THREE.MeshBasicMaterial({map:ee}),Wt=new THREE.Mesh(mo,Vs);Wt.position.z=279+.05,Wt.position.y=12,Wt.position.x=-10,O.add(Wt);const As=new THREE.BoxGeometry(2,15-2*1-5,1),qe=new THREE.Mesh(As,j);qe.position.x=-8-25/2+1/2,qe.position.z=280-1/2,qe.position.y=.5,O.add(qe);const Mt=new THREE.Mesh(As,j);Mt.position.x=-12+25/2-1/2,Mt.position.z=280-1/2,Mt.position.y=.5,O.add(Mt),U.castShadow=!0,U.receiveShadow=!0,q.castShadow=!0,q.receiveShadow=!0,pe.castShadow=!0,pe.receiveShadow=!0,Ue.castShadow=!0,Ue.receiveShadow=!0,it.receiveShadow=!0,it.castShadow=!0,Mt.castShadow=!0,Mt.receiveShadow=!0,qe.castShadow=!0,qe.receiveShadow=!0,b.add(O),O.rotation.y=.6,O.position.x=-180,O.position.z=40,u(-34,10,279),u(-38,10,281.5),u(-37.5,16.3,281),u(-30.5,14.3,276),u(-27.7,10.2,274.5),u(-23,12,271),u(-25.5,17.2,272.7),u(-35.5,17.2,279.5)}function u(C,L,P){const D=new THREE.SphereGeometry(.2,8,8),O=new THREE.MeshStandardMaterial({color:8409292}),ee=new THREE.Mesh(D,O);ee.position.z=P,ee.position.y=L,ee.position.x=C,b.add(ee)}function p(C,L,P,D){const X=new THREE.CylinderGeometry(1.8,2,.3,12),U=new THREE.MeshStandardMaterial({color:107374182,map:r});for(let W=0;W<P;W++){const q=new THREE.Mesh(X,U);q.position.x=L+W/P*D-D/2+Math.random()*1,q.position.y=.3/2,q.rotation.y=Math.random()*Math.PI,q.position.z=C-Math.random()*2,b.add(q);const K=new THREE.Mesh(X,U);K.position.x=L+W/P*D-D/2+Math.random()*1,K.position.y=.3/2,K.rotation.y=Math.random()*Math.PI,K.position.z=C+5+Math.random()*2,b.add(K)}Fe.render(b,be)}function g(C,L,P,D){const X=new THREE.CylinderGeometry(1.8,2,.3,12),U=new THREE.MeshStandardMaterial({color:107374182,map:r});for(let W=0;W<P;W++){const q=new THREE.Mesh(X,U);q.position.z=C+W/P*D-D/2+Math.random()*1,q.position.y=.3/2,q.rotation.y=Math.random()*Math.PI,q.position.x=L-Math.random()*2,b.add(q);const K=new THREE.Mesh(X,U);K.position.z=C+W/P*D-D/2+Math.random()*1,K.position.y=.3/2,K.rotation.y=Math.random()*Math.PI,K.position.x=L+5+Math.random()*2,b.add(K)}Fe.render(b,be)}function v(){const L=new THREE.CylinderGeometry(2,5,70,12),P=new THREE.MeshStandardMaterial({color:4860687,map:r}),D=new THREE.Mesh(L,P);D.castShadow=!0,D.receiveShadow=!0,D.position.set(0,0+70/2,0),b.add(D),tn=new THREE.Box3().setFromObject(D);const O=new THREE.IcosahedronGeometry(15,1),ee=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r}),ie=[];for(let j=0;j<5;j++){let X=new THREE.Mesh(O,ee);X.position.set(0+Math.random()*10-5,70-j*5,0+Math.random()*10-5),X.rotation.x=Math.random()*Math.PI,X.rotation.z=Math.random()*Math.PI,X.castShadow=!0,X.receiveShadow=!0,b.add(X),ie.push(X)}ie.forEach(j=>{let X=new THREE.Sphere;new THREE.Box3().setFromObject(j).getBoundingSphere(X),cc.push(X)})}function E(){const C=[R,B,k,A,S],L=150,P=1500,D=100,O=P/2,ee=50;let ie=[];function j(X,U){return ie.some(W=>{let q=W.x-X,K=W.z-U;return Math.sqrt(q*q+K*K)<ee})}for(let X=0;X<L;X++){let U,W,q,K=0;W=0;do{switch(Math.floor(Math.random()*4)){case 0:U=Math.random()*P-O,q=O-Math.random()*D;break;case 1:U=Math.random()*P-O,q=-O+Math.random()*D;break;case 2:U=-O+Math.random()*D,q=Math.random()*P-O;break;case 3:U=O-Math.random()*D,q=Math.random()*P-O;break}K++}while(j(U,q)&&K<100);if(K<100){const pe=C[Math.floor(Math.random()*C.length)];pe(U,W,q),ie.push({x:U,z:q})}}}function R(C,L,P){const D=40+Math.random()*80,O=new THREE.CylinderGeometry(5,8+Math.random()*4,D,8,1,!0),ee=new THREE.MeshStandardMaterial({color:6902838,side:THREE.DoubleSide,map:r}),ie=new THREE.Mesh(O,ee);ie.position.set(C,L+D/2,P),b.add(ie);const j=new THREE.BoxGeometry(20+Math.random()*30,20+Math.random()*30,20+Math.random()*30),X=new THREE.MeshStandardMaterial({color:6868090,map:r}),U=new THREE.Mesh(j,X);U.position.set(C,L+D,P),U.rotation.x=Math.random()*Math.PI,U.rotation.z=Math.random()*Math.PI,b.add(U);const W=new THREE.Mesh(j,X);W.position.set(C+3,L+D,P+1),W.rotation.x=Math.random()*Math.PI,W.rotation.z=Math.random()*Math.PI,b.add(W);const q=new THREE.Mesh(j,X);q.position.set(C-3,L+D,P+1),q.rotation.x=Math.random()*Math.PI,q.rotation.z=Math.random()*Math.PI,b.add(q)}function B(C,L,P){const D=50+Math.random()*100,O=new THREE.CylinderGeometry(2,8+Math.random()*2,D,12),ee=new THREE.MeshStandardMaterial({color:4860687,map:r}),ie=new THREE.Mesh(O,ee);ie.position.set(C,L+D/2,P),b.add(ie);const j=new THREE.IcosahedronGeometry(15+Math.random()*30,1),X=new THREE.MeshStandardMaterial({color:4039517,side:THREE.DoubleSide,map:r});for(let U=0;U<5;U++){let W=new THREE.Mesh(j,X);W.position.set(C+Math.random()*10-5,L+D-U*5,P+Math.random()*10-5),W.rotation.x=Math.random()*Math.PI,W.rotation.z=Math.random()*Math.PI,b.add(W)}}function k(C,L,P){const O=(150+Math.random()*150)*.3,ee=1.5+Math.random()*2,ie=2.5+Math.random()*8,j=new THREE.CylinderGeometry(ee,ie,O,16),X=new THREE.MeshStandardMaterial({color:9127187,map:r}),U=new THREE.Mesh(j,X);U.position.set(C,L+O/2,P),b.add(U);const W=20+Math.random()*30,q=new THREE.SphereGeometry(W,16,16),K=new THREE.MeshStandardMaterial({color:2263842,map:r}),pe=new THREE.Mesh(q,K);pe.position.set(C,L+O+W*.6,P),b.add(pe)}function A(C,L,P){const D=80+Math.random()*90,O=D*.5,ee=3+Math.random()*5,ie=new THREE.CylinderGeometry(ee,ee,O,12),j=new THREE.MeshStandardMaterial({color:9127187,map:r}),X=new THREE.Mesh(ie,j);X.position.set(C,L+O/2,P),b.add(X);const U=100+D/4,W=new THREE.SphereGeometry(10+Math.random()*20,8,8),q=new THREE.MeshStandardMaterial({color:16758725,map:r});for(let K=0;K<U;K++){const pe=new THREE.Mesh(W,q),Ue=Math.random()*Math.PI*2,Ct=L+O+Math.random()*D*.5,We=2+Math.random()*15;pe.position.set(C+Math.cos(Ue)*We,Ct,P+Math.sin(Ue)*We),b.add(pe)}}function S(C,L,P){const D=100+Math.random()*150,O=D*.25,ee=2+Math.random()*2,ie=5+Math.random()*3,j=new THREE.CylinderGeometry(ee,ie,O,12),X=new THREE.MeshStandardMaterial({color:9127187,map:r}),U=new THREE.Mesh(j,X);U.position.set(C,L+O/2,P),b.add(U);const W=4+Math.random()*3,q=20+Math.random()*40,K=(D-O)/W-1;for(let pe=0;pe<W;pe++){const Ue=q*((W-pe)/W),Ct=new THREE.ConeGeometry(Ue,K+3,6),We=new THREE.MeshStandardMaterial({color:2263842,map:r}),it=new THREE.Mesh(Ct,We);it.position.set(C,L+O+(pe*K+K/2),P),b.add(it)}}function ne(){const C=new THREE.Group,L=Math.floor(Math.random()*2)+1;for(let P=0;P<L;P++){const D=Math.random()*50+20,O=new THREE.IcosahedronGeometry(D,1),ee=new THREE.MeshStandardMaterial({color:16777215,transparent:!0,opacity:Math.random()*.3+.05}),ie=new THREE.Mesh(O,ee),j=Math.random()*30-15,X=Math.random()*10-5,U=Math.random()*30-15;ie.position.set(j,X,U),C.add(ie)}return C}function ge(C,L){for(let P=0;P<80;P++){const D=ne(),O=Math.random()*1700-1e3,ee=Math.random()*L+C,ie=Math.random()*1700-1e3;D.position.set(O,ee,ie),b.add(D),a.push(D)}}function Y(){requestAnimationFrame(Y),a.forEach(C=>{C.position.x+=.1}),Fe.render(b,be)}}function lc(){requestAnimationFrame(lc),ui(rc),ui(ac);const o=new THREE.Vector3(0,0,-1);o.applyQuaternion(be.quaternion);const e=Kt.movementSpeed*.1,t=be.position.clone().add(o.multiplyScalar(e)),s=Zm(t);s.collided?jm(o,e,s.normal):Kt.update(.1),Fs.rotation.y+=.01,Fe.render(b,be)}function jm(o,e,t){const s=o.clone().projectOnVector(t);let n=o.clone().sub(s);n.dot(o)>0&&n.negate();const i=be.position.clone().add(n.normalize().multiplyScalar(e));be.position.copy(i)}function Ym(){be.aspect=window.innerWidth/window.innerHeight,be.updateProjectionMatrix(),Fe.setSize(window.innerWidth,window.innerHeight)}function Zm(o){if(tn.containsPoint(o))return{collided:!0,normal:Jm(tn,o)};for(let e of cc)if(o.distanceTo(e.center)<e.radius)return{collided:!0,normal:new THREE.Vector3().subVectors(o,e.center).normalize()};return{collided:!1}}function Jm(o,e){const t=new THREE.Vector3().copy(e).clamp(o.min,o.max);return new THREE.Vector3().subVectors(e,t).normalize()}function ui(o){const e=o.geometry.attributes.position.array;for(let t=0;t<e.length;t+=3)e[t+1]-=.1,e[t+1]<0&&(e[t+1]+=50);o.geometry.attributes.position.needsUpdate=!0}
